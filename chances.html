<html>
    <head>
        <title>Fallout 76 Drop Chances</title>
        <style>
            * {
                font-family: sans-serif;
                font-size: 20px;
            }
            td {
                padding: 2px;
            }
            
            table.infoTable {
               border: 1px solid black;
               border-collapse: collapse;
            }
            table.infoTable td {
               border: 1px solid black;
            }
        </style>
        <meta name="keywords" content="Fallout,Fallout 76,RNG,Random,Chances,Leveled,Leveled List,LVLI,Datamine">
    </head>
    <body>
        <center>
            <span style="font-size: 36px; font-weight: bold;">Fallout 76 Drop Chances (0.0.1)</span><br/>
            <br/>
            <br/>
            Select version:
            <select id='versionselect'>
                <option value='P19' selected='selected'>Update 19: 19th May, 2020 (latest)</option>
            </select>
            &nbsp;&nbsp;
            <button id='loadversion'>Load</button>
            &nbsp; (Note that the site downloads about 3MB for the selected version!)
            <hr>
        </center>
        <script>
            // property key is the FormID, property value is the Group string (4chars) concatenated with the EditorID
            var edids = {};
            // property key is the FormID, property value is the global float
            var globals = {};
            // property key is the FormID, property value is the leveled list object
            var leveledLists = {};

            var downloadDone = 0;

            function allDownloaded() {
                document.getElementById("loadversion").disabled = false;
                // TODO 
            }

            function fetchData(name, whenDone) {
                fetch(name, {
                    method: "GET",
                    headers: {
                        Accept: "application/json",
                        "Content-Type": "application/json"
                    },
                    mode: "no-cors"
                })
                .then(res => {
                    whenDone(res.json());
                    if (--downloadDone == 0) {
                        allDownloaded();
                    }
                })
                .catch(err=>{
                    console.log(xhr.responseText);
                    if (--downloadDone == 0) {
                        allDownloaded();
                    }
                });
            }

            function doLoad() {
                document.getElementById("loadversion").disabled = true;

                var versionSelect = document.getElementById("versionselect");
                if (versionSelect.selectedIndex >= 0) {
                    downloadDone = 3;
                    var patchPrefix = 
                        "https://akarnokd.github.com/rng-76/"
                        + versionSelect.options[versionSelect.selectedIndex].value + "_";

                    fetchData(patchPrefix + "SeventySix_EDIDs.json", res => {
                        edids = res;
                    });
                    fetchData(patchPrefix + "SeventySix_GLOBs.json", res => {
                        edids = res;
                    });
                    fetchData(patchPrefix + "SeventySix_LVLIs.json", res => {
                        edids = res;
                    });
                }
            }


            document.getElementById("loadversion").onclick = doLoad;
        </script>
    </body>
</html>