<html>
    <head>
        <title>Fallout 76 Drop Chances</title>
        <style>
            * {
                font-family: sans-serif;
                font-size: 20px;
            }
            td {
                padding: 2px;
            }
            
            table.infoTable {
               border: 1px solid black;
               border-collapse: collapse;
            }
            table.infoTable td {
               border: 1px solid black;
            }
        </style>
        <meta name="keywords" content="Fallout,Fallout 76,RNG,Random,Chances,Leveled,Leveled List,LVLI,Datamine">
    </head>
    <body>
        <center>
            <span style="font-size: 36px; font-weight: bold;">Fallout 76 Drop Chances (0.0.1)</span><br/>
            <br/>
            <br/>
            Select version:
            <select id='versionselect'>
                <option value='P19' selected='selected'>Update 19: 19th May, 2020 (latest)</option>
            </select>
            &nbsp;&nbsp;
            <button id='loadversion'>Load</button>
            &nbsp; (Note that the site downloads up to 3MB of data for the selected version!)
            <hr>
        </center>
        <script>
            // property key is the FormID, property value is the Group string (4chars) concatenated with the EditorID
            var edids = {};
            // property key is the FormID, property value is the global float
            var globals = {};
            // property key is the FormID, property value is the leveled list object
            var leveledLists = {};

            var downloadDone = 0;

            function allDownloaded() {
                document.getElementById("loadversion").disabled = false;
                // TODO 
                console.log(Object.keys(edids).length);
                console.log(Object.keys(globals).length);
                console.log(Object.keys(leveledLists).length);
            }

            function loadScript(src, callback) {
                var r = false;
                var s = document.createElement('script');
                s.type = 'text/javascript';
                s.src = src;
                s.onload = s.onreadystatechange = function() {
                    //console.log( this.readyState ); //uncomment this line to see which ready states are called.
                    if ( !r && (!this.readyState || this.readyState == 'complete') ) {
                        r = true;
                        callback(s);
                    }
                };
                var t = document.getElementsByTagName('script')[0];
                t.parentNode.insertBefore(s, t);
            }

            function doLoad() {
                document.getElementById("loadversion").disabled = true;

                var versionSelect = document.getElementById("versionselect");
                if (versionSelect.selectedIndex >= 0) {
                    downloadDone = 3;
                    var patchPrefix = 
                        // "https://akarnokd.github.com/rng-76/" +
                        versionSelect.options[versionSelect.selectedIndex].value + "_";

                    loadScript(patchPrefix + "SeventySix_EDIDs.js", node => {
                        if (--downloadDone == 0) {
                           allDownloaded();
                        }
                    });
                    loadScript(patchPrefix + "SeventySix_GLOBs.js", node => {
                        if (--downloadDone == 0) {
                           allDownloaded();
                        }
                    });
                    loadScript(patchPrefix + "SeventySix_LVLIs.js", node => {
                        if (--downloadDone == 0) {
                           allDownloaded();
                        }
                    });
                }
            }


            document.getElementById("loadversion").onclick = doLoad;
        </script>
    </body>
</html>