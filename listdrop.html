<html>
    <head>
        <title>Fallout 76 List drop Monte-carlo simulation</title>
        <style>
            * {
                font-family: sans-serif;
                font-size: 20px;
            }
            td {
                padding: 2px;
            }
            
            table.infoTable {
               border: 1px solid black;
               border-collapse: collapse;
            }
            table.infoTable td {
               border: 1px solid black;
            }
        </style>
    </head>
    <body>
        <center>
            <span style="font-size: 36px; font-weight: bold;">Fallout 76 List drop Monte-carlo simulation</span><br/>
            <br/>
            <br/>

        Options: <input id='count' type="number" min="1" value='3'><button id='createTableBtn'>Create</button>
        <br/><br/>
        <table id='main' style='border-collapse: collapse;'>
            <tr>
                <td>Absent percent</td>
                <td>Probability (sim)</td>
                <td>Probability (formula)</td>
                <td>Probability (first pick)</td>
            </tr>
        </table>
        <br/>
        Rounds: <input id='rounds' type="number" min="1" value='100000'>&nbsp;&nbsp;&nbsp;<button id='runBtn'>Run!</button>
        </center>

        <script>
            function createTable() {
                var n = parseInt(document.getElementById("count").value);
                var tbl = document.getElementById("main");

                for (var i = tbl.rows.length - 1; i > 0; i--) {
                    tbl.deleteRow(i);
                }

                for (var i = 1; i <= n; i++) {
                    var row = tbl.insertRow(i);

                    var c1 = row.insertCell(0);
                    c1.innerHTML = "<input id='option" + i + "' type='number' min='0' max='100' value='0'>";
                    c1.style.border = "1px solid black";

                    var c2 = row.insertCell(1);
                    c2.id = "prob" + i;
                    c2.innerText = "0.000 %";
                    c2.style.textAlign = "right";
                    c2.style.border = "1px solid black";

                    c2 = row.insertCell(2);
                    c2.id = "probf" + i;
                    c2.innerText = "0.000 %";
                    c2.style.textAlign = "right";
                    c2.style.border = "1px solid black";

                    c2 = row.insertCell(3);
                    c2.id = "probp" + i;
                    c2.innerText = "0.000 %";
                    c2.style.textAlign = "right";
                    c2.style.border = "1px solid black";
                }
            }

            function run() {
                var tbl = document.getElementById("main");

                var absentList = [];

                for (var i = 1; i < tbl.rows.length; i++) {
                    absentList.push(
                        { 
                            index: i, 
                            absent: parseInt(document.getElementById("option" + i).value) / 100.0,
                            occurrence: 0
                        }
                    );
                }

                var rounds = parseInt(document.getElementById("rounds").value);

                for (var j = 0; j < rounds; j++) {
                    var presentList = [];
                    for (var e of absentList) {
                        if (Math.random() >= e.absent) {
                            presentList.push(e);
                        }
                    }

                    if (presentList.length > 0) {
                        var index = Math.floor(Math.random() * presentList.length);
                        presentList[index].occurrence++;
                    }
                }

                for (var e of absentList) {
                    document.getElementById("prob" + e.index).innerText = (100.0 * e.occurrence / rounds).toFixed(3) + " %";
                    e.occurrence = 0;
                }

                // run as first pick
                for (var j = 0; j < rounds; j++) {
                    for (var e of absentList) {
                        if (Math.random() >= e.absent) {
                            e.occurrence++;
                            break;
                        }
                    }
                }

                for (var e of absentList) {
                    document.getElementById("probp" + e.index).innerText = (100.0 * e.occurrence / rounds).toFixed(3) + " %";
                }

                var combinations = 1 << absentList.length;

                var probCombinations = new Array(combinations);
                for (var n = 0; n < combinations; n++) {
                    var product = 1.0;
                    var bits = 0;
                    for (var m = 0; m < absentList.length; m++) {
                        var bitMask = 1 << m;
                        if ((n & bitMask) != 0) {
                            bits++;
                            product *= (1 - absentList[m].absent);
                        } else {
                            product *= absentList[m].absent;
                        }
                    }
                    probCombinations[n] = product / Math.max(1, bits);
                }

                for (var m = 0; m < absentList.length; m++) {
                    var bitMask = 1 << m;
                    var sum = 0.0;
                    for (var n = 0; n < combinations; n++) {
                        if ((n & bitMask) != 0) {
                            sum += probCombinations[n];
                        }
                    }
                    document.getElementById("probf" + (m + 1)).innerText = (100.0 * sum).toFixed(5) + " %";
                }
            }

            document.getElementById("createTableBtn").onclick = createTable;
            document.getElementById("runBtn").onclick = run;

            createTable();
        </script>
    </body>
</html>