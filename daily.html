<html>
    <head>
        <title>Fallout 76 Daily/Weekly Atom/S.C.O.R.E. Challenges</title>
        <style>
            * {
                font-family: sans-serif;
                font-size: 20px;
            }
            td {
                padding: 2px;
            }
            
            table.infoTable {
               border: 1px solid black;
               border-collapse: collapse;
            }
            table.infoTable td {
               border: 1px solid black;
            }
        </style>
        <meta name="keywords" content="Fallout,Fallout 76,Daily,Challenge,Challenges,Atom,Weekly,Score,S.C.O.R.E.">
    </head>
    <body>
        <center>
            <span style="font-size: 36px; font-weight: bold;">Fallout 76 Daily/Weekly Atom/S.C.O.R.E. Challenges (0.3.1)</span><br/>
            <br/>
            <br/>
            <table>
                <tr>
                    <td><button id='prevWeek' title='Go back a week.'>&lt;&lt;</button></td>
                    <td><button id='prevDay' title='Previous day.'>&lt;</button></td>
                    <td id='showndate' style='font-size: 24; text-align: center;'></td>
                    <td><button id='nextDay' title='Next day.'>&gt;</button></td>
                    <td><button id='nextWeek' title='Go forward a week.'>&gt;&gt;</button></td>
                </tr>
            </table>
            <br/>
            <br/>
            <table id='challenges'>
            </table>
        </center>
        <script>

            var oneHourLaterSince = new Date(Date.UTC(2020, 5, 30, 15, 0, 0, 0));

            function normalizeDate(date) {
                if (date < oneHourLaterSince) {
                    date.setUTCHours(15, 0, 0, 0);
                } else {
                    date.setUTCHours(16, 0, 0, 0);
                }
            }

            var selectedDate = new Date();
            normalizeDate(selectedDate);
            
            var now = new Date();
            if (selectedDate > now) {
                selectedDate.setDate(selectedDate.getDate() - 1);
            }

            var dsrc = document.location.search;
            if (dsrc.includes("day=")) {
                var idx = dsrc.indexOf("day=");
                var date = dsrc.substring(idx + 4);
                try {
                    selectedDate = new Date(date);
                } catch (e) {
                    // ignored
                }
            }

            function levelUpFasnacht(offset) {
                return {
                            name: "Level up while (any 3)",
                            offset: offset,
                            period: 3,
                            subchallenges: [
                                {
                                    name: "Being level 76 or higher"
                                },
                                {
                                    name: "Wearing a Fasnacht Mask",
                                    tipId: "LevelUpFasnacht",
                                    tip: "There is usually a Fasnacht Man Mask in Fort Defiance."
                                },
                                {
                                    name: "Wearing Responder's Gear",
                                    tipId: "LevelUpResponders",
                                    tip: "Responder's Jumpsuit, Paramedic Jumpsuit, Pastor's Vestments should work."
                                },
                                {
                                    name: "Holding a Protest Sign",
                                    tipId: "LevelUpProtest",
                                    tip: "Fast travel to Poseidon Energy Plant and among the tents, there are a couple of protest signs."
                                },
                                {
                                    name: "on Deathclaw Island"
                                },
                                {
                                    name: "in a Group"
                                },
                                {
                                    name: "at Arktos Pharma under level 20"
                                },
                                {
                                    name: "at Wavy Willard's Water Park under level 30"
                                },
                                {
                                    name: "Naked"
                                },
                                {
                                    name: "Engaged in PvP"
                                },
                            ]
                        };
            }

            function levelUpWhitesprings(offset) {
                return {
                            name: "Level up while (any 3)",
                            offset: offset,
                            period: 6,
                            subchallenges: [
                                {
                                    name: "Being level 76 or higher"
                                },
                                {
                                    name: "At a Fissure site",
                                    tipId: "LevelUpFissure",
                                    tip: "Only the on-map named fissure sites count."
                                },
                                {
                                    name: "At/in Morgantown Airport under level 20"
                                },
                                {
                                    name: "In Whitesprings",
                                    tipId: "LevelUpWhitesprings",
                                    tip: "Be anywhere within the fenced area of the hotel, including the interior."
                                },
                                {
                                    name: "Near Grahm and Chally"
                                },
                                {
                                    name: "Wearing an Asylum Uniform and Hat",
                                    tipId: "LevelUpAsylum",
                                    tip: "Fort Defiance (Allegheny Asylum) has many Uniforms and Hats."
                                },
                                {
                                    name: "Wearing sunglasses"
                                },
                                {
                                    name: "Using chems"
                                },
                                {
                                    name: "Engaged in PvP"
                                },
                                {
                                    name: "Wielding a sword",
                                    tipId: "LevelUpSword",
                                    tip: "Machete and any weapon with Sword in its name should work."
                                }
                            ]
                        };
            }

            function levelUpWatoga(offset) {
                return {
                            name: "Level up while (any 3)",
                            offset: offset,
                            period: 6,
                            subchallenges: [
                                {
                                    name: "Being level 76 or higher"
                                },
                                {
                                    name: "In Watoga",
                                    tipId: "LevelUpWatoga",
                                    tip: "Be within the city bounds or the interior of the EMS, AMS, Civic Center or Municipal Center."
                                },
                                {
                                    name: "Wielding a music instrument as a weapon",
                                    tipId: "LevelUpMusic",
                                    tip: "Death Tambo, Guitar Sword or War Drum should work."
                                },
                                {
                                    name: "At/in the Top of the World under level 40"
                                },
                                {
                                    name: "At/in Vault-Tec Agricultural Research Center under level 10"
                                },
                                {
                                    name: "Wearing Formal Wear"
                                },
                                {
                                    name: "Wearing an Unstoppables Costume"
                                },
                                {
                                    name: "in Power Armor"
                                },
                                {
                                    name: "Well Fed"
                                },
                                {
                                    name: "Engaged in PvP"
                                },
                            ]
                        };
            }

            function levelUpCaves(offset) {
                return {
                            name: "Level up while (any 3)",
                            offset: offset,
                            period: 3,
                            subchallenges: [
                                {
                                    name: "Being level 76 or higher"
                                },
                                {
                                    name: "In Caves or Mines",
                                    tipId: "LevelUpCave",
                                    tip: "Unfortunately, Big Bent Tunnel doesn't count."
                                },
                                {
                                    name: "In a Workshop under level 20"
                                },
                                {
                                    name: "Well Tuned or Well Rested",
                                    tipId: "LevelUpWellTuned",
                                    tip: "Warning! Currently, Lover's Embrace and similar Ally-granted 3 hour bonus"
                                         + "<br>do not count towards this so make sure you are Well Tuned!"
                                },
                                {
                                    name: "Wielding an Axe",
                                    tipId: "LevelUpAxe",
                                    tip: "Grognak's Axe, Fire Axe, Pickaxe or Multi-purpose Axe should work."
                                },
                                {
                                    name: "In a Nuked Region"
                                },
                                {
                                    name: "Wearing a full Clown Suit",
                                    tipId: "LevelUpClown",
                                    tip: "Freddy Fear's House of Scares usually has a Clown Suit and Clown Hat."
                                },
                                {
                                    name: "Wearing Sleepwear"
                                },
                                {
                                    name: "Diseased"
                                },
                                {
                                    name: "Engaged in PvP"
                                },
                            ]
                        };
            }

            function buildAnythingCamp(offset) {
                return {
                            name: "Build anything in your C.A.M.P. or Workshop (x10)",
                            offset: offset,
                            period: 10,
                            tipId: "BuildAnything",
                            tip: "Floor Mat is the cheapest to build"
                        };
            }

            function craftAmmo(offset) {
                return {
                            name: "Craft Ammo (x50)",
                            offset: offset,
                            period: 10,
                            tipId: "CraftAmmo",
                            tip: "The perk Ammosmith doesn't count for this challenge."
                        };
            }

            function killSheepsquatch(offset) {
                return {
                            name: "Kill a Sheepsquatch",
                            offset: offset,
                            period: 10,
                            tipId: "KillSheepsquatch",
                            tip: "Other than the Free Range event, they are random encounters."
                        };
            }

            function scrapFiberglass(offset) {
                return {
                            name: "Scrap junk to produce Fiberglass (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "ScrapFiberglass",
                            tip: "Scrap the telephones at the National Isolated Radio Array offices."
                        };
            }

            function scrapScrews(offset) {
                return {
                            name: "Scrap junk to produce Screws (x5)",
                            offset: offset,
                            period: 5,
                            tipId: "ScrapScrews",
                            tip: "Scrap the globes, fans and typewriters at the National Isolated Radio Array offices."
                        };
            }

            function scrapSprings(offset) {
                return {
                            name: "Scrap junk to produce Springs (x5)",
                            offset: offset,
                            period: 5,
                            tipId: "ScrapSprings",
                            tip: "Simply scrap Bulk Springs."
                        };
            }

            function killLegendary(offset) {
                return {
                            name: "Kill a Legendary enemy",
                            offset: offset,
                            period: 5,
                            tipId: "KillLegendary",
                            tip: "Check out horde events, fissure sites or West Tek."
                        };
            }

            function killLegendaryFissure(offset) {
                return {
                            name: "Kill a Legendary at a fissure site",
                            offset: offset,
                            period: 5,
                            tipId: "KillLegendaryFissure",
                            tip: "Named fissure sites only. Works best at Prime. " 
                                 + "<br>You have to be very close to the edge of the fissure site."
                                 + "<br>The enemy can be further away."
                        };
            }
            function buildFloorsCamp(offset) {
                return {
                            name: "Build floors, walls and roofs in your C.A.M.P. (x10)",
                            offset: offset,
                            period: 5,
                            tipId: "BuildFloors",
                            tip: "Remember to equip the Contractor perk card."
                        };
            }

            function buildLightingCamp(offset) {
                return {
                            name: "Build lighting in your C.A.M.P. or Workshop (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "BuildLights",
                            tip: "Remember to equip the Contractor perk card."
                        };
            }

            function destroyTurrets(offset) {
                return {
                            name: "Destroy turrets (x5)",
                            offset: offset,
                            period: 30,
                            tipId: "DestroyTurrets",
                            tip: "Check out the Relay Towers."
                        };
            }

            function destroyRobots(offset) {
                return {
                            name: "Destroy robots (x5)",
                            offset: offset,
                            period: 30,
                            tipId: "DestroyRobots",
                            tip: "Check out the Vault-tec Agricultural Research Center near Flatwoods."
                        }
            }

            function killRadscorpions(offset) {
                return {
                            name: "Kill Radscorpions in the Savage Divide (x5)",
                            offset: offset,
                            period: 30,
                            tipId: "KilLRadScorpions",
                            tip: "Middle mountain Cabins, Top of the World and The Freakshow may have them."
                        };
            }

            function eatCandy(offset) {
                return {
                            name: "Eat pies, candies and sweets (x20)",
                            offset: offset,
                            period: 10,
                            tipId: "EatPies",
                            tip: "Gum drop works too but Dandy Boy Apples doesn't."
                        };
            }

            function harvestFungi(offset) {
                return {
                            name: "Harvest Fungi (x10)",
                            offset: offset,
                            period: 10,
                            tipId: "HarvestFungi",
                            tip: "Check out the river towards Flatwoods."
                        };
            }

            function killMoleMiner(offset) {
                return {
                            name: "Kill a Mole Miner",
                            offset: offset,
                            period: 10,
                            tipId: "KillMoleminer",
                            tip: "Check out the rooftop in Welch visible from the Station fast travel point."
                                 + "<br>Check out Blackwater Mine (exterior and interior) near The Whitespring resort."
                        };
            }

            function claimWorkshop(offset) {
                return {
                            name: "Claim a Workshop",
                            offset: offset,
                            period: 5,
                            tipId: "ClaimWorkshop",
                            tip: "Remember to stay crouched at all times and leave the build area"
                                  + "<br>as soon as you can to avoid unwanted PvP."
                        };
            }
            function killDeathclawIsland(offset) {
                return {
                            name: "Kill a Deathclaw on Deathclaw Island",
                            offset: offset,
                            period: 20,
                        };
            }
            function killDeathclaw(offset) {
                return {
                            name: "Kill a Deathclaw",
                            offset: offset,
                            period: 20,
                            tipId: "KillDeathclaw",
                            tip: "Check out Deathclaw Island or the Thunder Mountain Substation"
                                  + "<br>TM-02 north of Watoga."
                        };
            }

            function craftHealing(offset) {
                return {
                            name: "Craft Healing Items (any 5)",
                            offset: offset,
                            period: 10,
                            tipId: "CraftHealingItems",
                            tip: "Bug/tip: Crafting Healing Salve counts for crafting a Stimpak too.",
                            subchallenges: [
                                {
                                    name: "Antibiotics",
                                    tipId: "CraftAntibiotics",
                                    tip: "The plans are available in the Enclave Bunker Medical section."
                                },
                                {
                                    name: "Bloodpack",
                                    tipId: "CraftBloodpack",
                                    tip: "Requires Tick Blood (2) + Antiseptic (1)."
                                },
                                {
                                    name: "Diluted Radaway",
                                    tipId: "CraftDilutedRadaway",
                                    tip: "Radaway + Purified water"
                                },
                                {
                                    name: "Diluted Stimpak",
                                    tipId: "CraftDilutedStimpak",
                                    tip: "Stimpak + Purified water"
                                },
                                {
                                    name: "Disease Cure",
                                    tipId: "CraftDiseaseCure",
                                    tip: "Firecap (2) + Bloodleaf (2) + Snaptail Reed (2)."
                                        + "<br>Start from Slocum Joe's to pick up Firecap around, then go to the river"
                                        + "<br>towards Flatwoods to find Bloodleaf and then Snaptail Reed."
                                        + "<br>Don't forget to equip the Green Thumb (PER) perk card."
                                },
                                {
                                    name: "Glowing Bloodpack",
                                    tipId: "CraftGlowingBloodpack",
                                    tip: "Bloodpack + Glowing Blood + Antiseptic"
                                },
                                {
                                    name: "Healing Salve",
                                    tipId: "CraftHealingSalve",
                                    tip: "Soot Flower + Rhododendron Flower + Boiled Water. Check around the Overseer's Camp."
                                },
                                {
                                    name: "Skeeto Spit",
                                    tipId: "CraftSkeetoSpit",
                                    tip: "Blood Pack + Bloodleaf + Glass + Steel"
                                },
                                {
                                    name: "Standard Radaway",
                                    tipId: "CraftRadaway",
                                    tip: "Antiseptic + Glowing Fungus (3) + Purified Water + Plastic"
                                },
                                {
                                    name: "Standard Stimpak",
                                    tipId: "CraftStimpak",
                                    tip: "Antiseptic (2) + Blood Pack + Steel"
                                },
                                {
                                    name: "Super Stimpak",
                                    tipId: "CraftSuperStimpak",
                                    tip: "Ultracite + Antiseptic (2) + Blood Pack + Steel + Strangler Pod + Corpse Flower Stamen"
                                }
                            ]
                        };
            }

            function plantVegetables(offset) {
                return {
                            name: "Plant vegetables in your C.A.M.P. or Workshop (x10)",
                            offset: offset,
                            period: 10,
                            tipId: "PlantVegetables",
                            tip: "You can scrap and replant your vegetables."
                        };
            }

            function pickFlowers(offset) {
                return {
                            name: "Pick flowers (x10)",
                            offset: offset,
                            period: 10,
                            tipId: "PickFlowers",
                            tip: "Rododendron (magenta) and Soot Flower (blue) are easy to spot."
                                 + "<br>Bloodleaf works too, found in the river towards Flatwoods."
                        };
            }

            function revivePlayer(offset) {
                return {
                            name: "Revive a Player",
                            offset: offset,
                            period: 10,
                            tipId: "RevivePlayer",
                            tip: "No need to team up. Jump down from some height to down yourself."
                        };
            }

            function destroyLiberators(offset) {
                return {
                            name: "Destroy Liberators (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "DestroyLiberators",
                            tip: "Tygart Water Treatment north of Sommersville has a bunch of them."
                        };
            }

            function killGhoulNuked(offset) {
                return {
                            name: "Kill Ghouls in a nuked region (x5)",
                            offset: offset,
                            period: 30,
                            tipId: "KillGhoulsNuled",
                            tip: "Nuke Whitesprings. Equip the Glow Sight perk for bonus damage."
                        };
            }

            function killRadroaches(offset) {
                return {
                            name: "Kill Radroaches in the Toxic Valley (x5)",
                            offset: offset,
                            period: 20,
                            tipId: "KillRadroaches",
                            tip: "Check around Hemlock Holes and Clarksburg Shooting Club."
                        };
            }

            function destroyRobotsWatoga(offset) {
                return {
                            name: "Destroy Robots in Watoga (x10)",
                            offset: offset,
                            period: 30,
                            tipId: "DestroyRobotsWatoga",
                            tip: "Liberators inside EMS and Mr. Gutsy random spawns count too. Some Watoga Mr. Handys don't count."
                        };
            }

            function chewBubblegum(offset) {
                return {
                            name: "Chew Bubblegum (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "ChewBubblegum",
                            tip: "Gum drops don't work. Perk pack bubblegums do work."
                                + "<br>Find bubblegum in Whitesprings or in the Pumpkin House."
                        };
            }

            function killGlowing(offset) {
                return {
                            name: "Kill a Glowing Enemy",
                            offset: offset,
                            period: 10,
                            tipId: "KillGlowing",
                            tip: "They are everywhere. Equip the Glow Sight perk for bonus damage."
                        };
            }

            function killMirelurks(offset) {
                return {
                            name: "Kill Mirelurks (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "KillMirelurk",
                            tip: "Ohio River Adventures spawns them regularly."
                                 + "Alternatively, start the defense miscellaneous quest with Fishbones there."
                        };
            }

            function harvestVegetables(offset) {
                return {
                            name: "Harvest vegetables (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "HarvestVegetables",
                            tip: "Your C.A.M.P., someone else's C.A.M.P. or simply any world spawn will do."
                        };
            }

            function killWendigoCave(offset) {
                return {
                            name: "Kill a Wendigo in the Wendigo Cave",
                            offset: offset,
                            period: 30,
                            tipId: "KillWendigo",
                            tip: "You may have to hop servers and/or lob a grenade at the waterfall for it to spawn."
                        };
            }

            function killGulper(offset) {
                return {
                            name: "Kill a Gulper at the Gulper Lagoon",
                            offset: offset,
                            period: 30,
                            tipId: "KillGulper",
                            tip: "There are usually 3-4 of them."
                        };
            }

            function killAnglers(offset) {
                return {
                            name: "Kill Anglers in the Mire (x5)",
                            offset: offset,
                            period: 30,
                            tipId: "KillAngler",
                            tip: "There are usually 2 at the Thunder Mountain Substation TM-01 (South-east to Berkeley Springs Station) and"
                                 + "<br>there are 3 at the Gnarled Shallows (north of Thunder Mountain Power Plant)."
                        };
            }

            function collectCaps(offset) {
                return {
                            name: "Collect Caps (x100)",
                            offset: offset,
                            period: 10,
                            tipId: "CollectCaps",
                            tip: "Looting, selling, drinking Nuka cola products and quest rewards all count."
                        };
            }

            function cookMeals(offset) {
                return {
                            name: "Cook meals with vegetables or fungi (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "CookMeals",
                            tip: "Perhaps the easiest is to craft Razorgrain Soup."
                        };
            }

            function hackTerminal(offset) {
                return {
                            name: "Hack a Terminal",
                            offset: offset,
                            period: 10,
                            tipId: "HackTerminal",
                            tip: "The Arktos Pharma reception terminal requires no hacking perk cards."
                        };
            }
            function killCryptid(offset) {
                return {
                            name: "Kill a Cryptid",
                            offset: offset,
                            period: 10,
                            tipId: "KillCryptid",
                            tip: "Wendigo (Wendigo Cave), Grafton Monster (Charleston Trainyard),"
                                + "<br>Snallygaster (Toxic Larry's Meet'n'go) or Mothman (Cultist camps)"
                        };
            }
            function collectWater(offset) {
                return {
                            name: "Collect Water (x50)",
                            offset: offset,
                            period: 10,
                            tipId: "CollectWater",
                            tip: "Collecting water from water sources and boiling them also counts."
                        };
            }
            function eatPrewarFood(offset) {
                return {
                            name: "Eat Pre-war Food (x20)",
                            offset: offset,
                            period: 10,
                            tipId: "EatPrewarfood",
                            tip: "Dog Food is everywhere. Bubblegum and Gum Drops count too. Check out diners around the map."
                        };
            }
            
            function killYaoGuai(offset) {
                return {
                            name: "Kill a Yao Guai",
                            offset: offset,
                            period: 10,
                            tipId: "KillYaoGuai",
                            tip: "Check out Monongah Overlook or Dolly Sods Wilderness."
                        };
            }

            var challengesDailyEra1 = {
                validStart: new Date(Date.UTC(2020, 3, 22, 15, 0, 0, 0)),
                validEnd: new Date(Date.UTC(2020, 4, 31, 15, 0, 0, 0)),
                options: [
                    levelUpFasnacht(0),
                    levelUpWhitesprings(1),
                    levelUpWatoga(4),
                    levelUpCaves(2),
                    buildAnythingCamp(0),
                    craftAmmo(0),
                    killSheepsquatch(0),
                    scrapFiberglass(0),
                    scrapScrews(1),
                    scrapSprings(3),
                    killLegendary(1),
                    killLegendaryFissure(3),
                    buildFloorsCamp(1),
                    buildLightingCamp(2),
                    destroyTurrets(1),
                    destroyRobots(11),
                    killRadscorpions(21),
                    eatCandy(2),
                    harvestFungi(2),
                    killMoleMiner(2),
                    claimWorkshop(3),
                    killDeathclawIsland(3),
                    killDeathclaw(13),
                    plantVegetables(4),
                    pickFlowers(4),
                    revivePlayer(4),
                    destroyLiberators(4),
                    killGhoulNuked(6),
                    killRadroaches(16),
                    destroyRobotsWatoga(26),
                    chewBubblegum(7),
                    killGlowing(7),
                    killMirelurks(7),
                    harvestVegetables(7),
                    killWendigoCave(8),
                    killGulper(18),
                    killAnglers(28),
                    collectCaps(9),
                    cookMeals(9),
                    hackTerminal(9),
                    killCryptid(9),
                    collectWater(5),
                    eatPrewarFood(5),
                    killYaoGuai(5),
                    craftHealing(5),
                ]
            };

            var challengesDailyEra1_2 = {
                validStart: new Date(Date.UTC(2020, 4, 31, 15, 0, 0, 0)),
                validEnd: new Date(Date.UTC(2020, 5, 1, 15, 0, 0, 0)),
                options: [
                    levelUpWhitesprings(0),
                    {
                        name: "Kill a Megasloth in the Cranberry Bog",
                        offset: 0,
                        period: 30,
                        tipId: "KillMegaslothCranberry",
                        tip: "They can show up between the Cranberry Glades and the Flooded Trainyard."
                    },
                    {
                        name: "Kill a Crave Cricket at/in the Uncanny Caverns",
                        offset: 0,
                        period: 30,
                        tipId: "KillCaveCricketUncanny",
                        tip: "May need several server hops. Outside and inside count."
                    },
                    {
                        name: "Kill Insects (x5)",
                        offset: 0,
                        period: 30,
                        tipId: "KillInsects",
                        tip: "."
                    },
                    {
                        name: "Kill Radants (x5)",
                        offset: 0,
                        period: 30,
                        tipId: "KillRadants",
                        tip: "Try Thunder Mountain Substation TM-02 north of Watoga."
                    }
                ]
            };

            var challengesDailyEra2 = {
                validStart: new Date(Date.UTC(2020, 5, 1, 15, 0, 0, 0)),
                validEnd: new Date(Date.UTC(2020, 5, 30, 15, 0, 0, 0)),
                options: [
                    levelUpFasnacht(0),
                    levelUpWatoga(1),
                    levelUpCaves(2),
                    levelUpWhitesprings(4),
                    collectCaps(0),
                    cookMeals(0),
                    hackTerminal(0),
                    killCryptid(0),
                    buildAnythingCamp(1),
                    craftAmmo(1),
                    killSheepsquatch(1),
                    scrapFiberglass(1),
                    killLegendary(2),
                    buildFloorsCamp(2),
                    destroyRobots(2),
                    scrapScrews(2),
                    buildLightingCamp(3),
                    eatCandy(3),
                    harvestFungi(3),
                    killMoleMiner(3),
                    scrapSprings(4),                
                    killLegendaryFissure(4),        
                    claimWorkshop(4),
                    killDeathclaw(4),
                    killDeathclawIsland(14),
                    plantVegetables(5),
                    pickFlowers(5),
                    revivePlayer(5),
                    destroyLiberators(5),
                    collectWater(6),
                    eatPrewarFood(6),
                    killYaoGuai(6),
                    craftHealing(6),
                    killRadroaches(7),
                    chewBubblegum(8),
                    killGlowing(8),
                    killMirelurks(8),
                    harvestVegetables(8),
                    killGulper(9),
                    killRadscorpions(12),
                    destroyRobotsWatoga(17),
                    killAnglers(19),
                    destroyTurrets(22),
                    killWendigoCave(29)
                ]
            };

            function scoreChewBubblegum(offset) {
                return {
                            name: "Chew Bubblegum",
                            offset: offset,
                            period: 10,
                        };
            }
            function scoreCompleteOneEvent(offset, times) {
                var title = "Complete an event";
                if (times > 1) {
                    title += " (x" + times + ")";
                }
                return {
                            name: title,
                            offset: offset,
                            period: 10,
                        };
            }
            function scoreKillScorched10(offset) {
                return {
                            name: "Kill Scorched (x10)",
                            offset: offset,
                            period: 10,
                        };
            }
            function scoreLevelUp1(offset) {
                return {
                            name: "Level up",
                            offset: offset,
                            period: 1,
                        };
            }
            function scoreScrapAluminium10(offset) {
                return {
                            name: "Scrap junk to produce Aluminium (x10)",
                            offset: offset,
                            period: 10,
                            tipId: "ScoreScrapAluminium",
                            tip: "Scrapping and rebulking Aluminium works best."
                        };
            }
            function scoreCompleteDailyChallenge5(offset) {
                return {
                            name: "&#x1F947; Gold: Complete a Daily Challenge (x5)",
                            offset: offset,
                            period: 1
                        };
            }

            function scoreBuildWallDecor5(offset) {
                return {
                            name: "Build floor or wall decoration in your C.A.M.P. or Workshop (x5)",
                            offset: offset,
                            period: 10,
                            tipId: "ScoreWallDecor",
                            tip: "Find the cheapest floor mat and equip Contractor 2 (INT) to have it cost 1 cloth."
                        };
            }

            function scoreCollectPurifiedWater3(offset) {
                return {
                            name: "Collect purified water (x3)",
                            offset: offset,
                            period: 10,
                        };
            }
            function scoreKillLegendary(offset, count) {
                var txt = "Kill/destroy a legendary enemy";
                if (count > 1) {
                    txt += " (x" + count + ")";
                }
                return {
                            name: txt,
                            offset: offset,
                            period: 10,
                        };
            }

            function scoreCraftRanged5(offset) {
                return {
                            name: "Craft or scrap a ranged weapon (x5)",
                            offset: offset,
                            period: 10,
                        };
            }

            function scoreKillCryptid3(offset) {
                return {
                            name: "Kill a Cryptid (x3)",
                            offset: offset,
                            period: 10,
                            tipId: "KillCryptid",
                            tip: "Wendigo (Wendigo Cave), Grafton Monster (Charleston Trainyard),"
                                + "<br>Snallygaster (Toxic Larry's Meet'n'go) or Mothman (Cultist camps)"
                        };
            }

            function scoreRepairArmorWeapon3(offset) {
                return {
                            name: "Repair armor or weapon (x3)",
                            offset: offset,
                            period: 10,
                        };
            }

            function scoreKillCreature15(offset) {
                return {
                            name: "Kill a creature (x15)",
                            offset: offset,
                            period: 10,
                        };
            }

            function scoreCollectAudiotape(offset) {
                return {
                            name: "Collect an audio Holotape",
                            offset: offset,
                            period: 10,
                        };
            }

            var challengesDailyEra3 = {
                validStart: new Date(Date.UTC(2020, 5, 30, 16, 0, 0, 0)),
                validEnd: undefined,
                options: [
                    scoreCompleteDailyChallenge5(0),
                    scoreChewBubblegum(0),
                    scoreCompleteOneEvent(0, 1),
                    scoreKillScorched10(0),
                    scoreLevelUp1(0),
                    scoreScrapAluminium10(0),

                    scoreBuildWallDecor5(1),
                    scoreCollectPurifiedWater3(1),
                    scoreCompleteOneEvent(1, 3),
                    scoreKillLegendary(1, 1),

                    scoreCompleteOneEvent(2, 2),
                    scoreCraftRanged5(2),
                    scoreKillCryptid3(2),
                    scoreRepairArmorWeapon3(2),

                    scoreCollectAudiotape(3),
                    scoreKillCreature15(3),
                    scoreKillLegendary(3, 3),
                    scoreCompleteOneEvent(3, 1)
                ]
            };

            var challenges = [
                challengesDailyEra1,
                challengesDailyEra1_2,
                challengesDailyEra2,
                challengesDailyEra3
            ];

            // ******************************************************************************************************************************

            function completeEvents(offset) {
                return {
                            name: "Complete Events (x10)",
                            offset: offset,
                            period: 14,
                            tipId: "CompleteEvents",
                            tip: "Enclave events don't count unfortunately."
                        };
            }
            function gatherBuildingSupplies(offset) {
                return {
                            name: "Gather Building Supplies (any 5)",
                            offset: offset,
                            period: 14,
                            tipId: "GatherBuildingSupplies",
                            tip: "You can simply scrap bulk items of these components.",
                            subchallenges: [
                                {
                                    name: "Aluminium (x50)",
                                },
                                {
                                    name: "Concrete (x50)",
                                },
                                {
                                    name: "Copper (x50)",
                                },
                                {
                                    name: "Fertilizer (x50)",
                                },
                                {
                                    name: "Oil (x50)",
                                },
                                {
                                    name: "Screws, spings or gears (x50)",
                                },
                                {
                                    name: "Steel (x250)"
                                },
                                {
                                    name: "Wood (x250)"
                                },
                            ]
                        };
            }
            function killInPowerArmor(offset) {
                return {
                            name: "Kill/destroy enemies in Power Armor (x10)",
                            offset: offset,
                            period: 14
                        };
            }
            function killLegendariesMany(offset) {
                return {
                            name: "Kill Legendary enemies (x5)",
                            offset: offset,
                            period: 14,
                            tipId: "KillLegendariesMany",
                            tip: "Named fissure sites, West-Tek and Horde-events are a good place to find them."
                        };
            }

            function completeEventsGroup(offset) {
                return {
                            name: "Complete Events in Group (x10)",
                            offset: offset,
                            period: 28,
                            tipId: "CompleteEventsGroup",
                            tip: "Yeah, you have to get into a team for this one."
                        };
            }
            function worldOnFire(offset) {
                return {
                            name: "Set the World on Fire (any 3)",
                            offset: offset,
                            period: 14,
                            subchallenges: [
                                {
                                    name: "Take a picture at a fissure site",
                                    tipId: "TakePictureFissure",
                                    tip: "You have to be at the very edge of a named fissure site and use Photomode."
                                },
                                {
                                    name: "Launch a Nuke",
                                },
                                {
                                    name: "Kill enemies with the flamer (x10)",
                                },
                                {
                                    name: "Find Silo code pieces (x2)",
                                    tipId: "FindSiloCodes",
                                    tip: "Currently bugged."
                                },
                                {
                                    name: "Kill a Scorchbeast"
                                },
                                {
                                    name: "Win a Hunter/Hunted match (x3)"
                                },
                                {
                                    name: "Level up while engaged in PvP"
                                }
                            ]
                        };
            }
            function acquireFlux(offset) {
                return {
                            name: "Acquire flux from nuked flora (all)",
                            offset: offset,
                            period: 28,
                            tipId: "AcquireFlux",
                            tip: "Nuke Whitesprings so that the Safe'n Clean Disposal, the Bunker and the Golf Club are covered."
                            +"<br>If luckly, all plants turn into their nuked ones, including the Snaptail Reeds."
                            +"<br>Otherwise, you have to nuke Fissure Prime too.",
                            subchallenges: [
                                {
                                    name: "Raw Cobalt (x3)",
                                },
                                {
                                    name: "Raw Crimson (x3)",
                                },
                                {
                                    name: "Raw Fluorescent (x3)",
                                },
                                {
                                    name: "Raw Violet (x3)",
                                },
                                {
                                    name: "Raw Yellowcake (x3)"
                                },
                            ]
                        };
            }
            function buildupCamp(offset) {
                return {
                            name: "Build up your C.A.M.P. (all)",
                            offset: offset,
                            period: 28,
                            subchallenges: [
                                {
                                    name: "Build containers, displays or shelves (x1)",
                                    tipId: "BuildupCampContainer",
                                    tip: "Simply build another Stash Box."
                                },
                                {
                                    name: "Build wall or floor decorations (x5)",
                                    tipId: "BuildupCampFloor",
                                    tip: "Floor mats are the cheapest to build."
                                },
                                {
                                    name: "Build doors or stairs (x5)",
                                },
                                {
                                    name: "Plant crops or build water sources (x10)",
                                    tipId: "BuildupCampCrops",
                                    tip: "Scrap and replant your vegetables."
                                },
                                {
                                    name: "Build generators or lighting (x20)",
                                    tipId: "BuildupCampLighting",
                                    tip: "Placing the cheapest standing lamp works."
                                },
                            ]
                        };
            }

            function scorchedTop(offset) {
                return {
                            name: "Kill Scorched at the Top of the World (x25)",
                            offset: offset,
                            period: 56,
                            tipId: "ScorchedTopWorld",
                            tip: "Most of them can be found inside. You can also aggro the Scorched from the nearby locations,"
                            + "<br>however, you have to be within 20 meters of the elevator when you kill them for it to count."
                        };
            }

            function pickManyFlowers(offset) {
                return {
                            name: "Pick different kinds of flowers (any 8)",
                            offset: offset,
                            period: 28,
                            tipId: "Pick many flowers",
                            tip: "The perk Green Thumb doesn't work consistently with this challenge",
                            subchallenges: [
                                {
                                    name: "Ash Rose (x10)",
                                    tipId: "PickManyFlowersAshRose",
                                    tip: "Around Welch in the Ash Heap and around the Fissure Site in the Ash Heap."
                                },
                                {
                                    name: "Bloodleaf (x10)",
                                    tipId: "PickManyFlowersBloodleaf",
                                    tip: "Start from the Wayward towards Flatwoods in the river."
                                },
                                {
                                    name: "Carrot Flowers (x10)",
                                    tipId: "PickManyFlowersCarrotFlower",
                                    tip: "In the front garden of the Palace of the Winding Path."
                                },
                                {
                                    name: "Fever Blossoms (x10)",
                                    tipId: "PickManyFlowersFeverBlossom",
                                    tip: "In The Deep, west of Whitesprings"
                                },
                                {
                                    name: "Fern Flowers (x10)",
                                    tipId: "PickManyFlowersFernFlower",
                                    tip: "Around Fissure Site Prime."
                                },
                                {
                                    name: "Gourd Flowers (x10)",
                                    tipId: "PickManyFlowersGourdFlower",
                                    tip: "In front of Sugarmaple on the road (east of Sommersville lake), Sundary Brothers' Cabin or Cobbleton farm."
                                },
                                {
                                    name: "Rhododendron Flowers (x10)",
                                    tipId: "PickManyFlowersRhododendron",
                                    tip: "Around Slocum Joe's and moving towards Flatwoods."
                                },
                                {
                                    name: "Strangler Blooms (x10)",
                                    tipId: "PickManyFlowersStranglerBlooms",
                                    tip: "West of Dyer Chemical along the riverbed, after completing An Organic Solution quest."
                                },
                                {
                                    name: "Soot Flowers (x10)",
                                    tipId: "PickManyFlowersSootFlower",
                                    tip: "Around Slocum Joe's and moving towards Flatwoods."
                                },
                                {
                                    name: "Tato Flowers (x10)",
                                    tipId: "PickManyFlowersTatoFlower",
                                    tip: "In the front garden outside of Vault 94."
                                },
                                {
                                    name: "Thistle Blooms (x10)",
                                    tipId: "PickManyFlowersThistleBlooms",
                                    tip: "North-east of the Wavy Willard Water Park and north of the nearby Willard Corporate Housing."
                                },
                            ]
                        };
            }

            function craftAlcohol15(offset) {
                return {
                            name: "Craft Alcohol (any 15)",
                            offset: offset,
                            period: 112,
                        };
            }

            function enemiesGrafton(offset) {
                return {
                            name: "Kill enemies in Grafton (x25)",
                            offset: offset,
                            period: 112,
                        };
            }

            function consumeAlcohol10(offset) {
                return {
                            name: "Consume Alcohol (any 10)",
                            offset: offset,
                            period: 112,
                        };
            }

            function criticalHits25(offset) {
                return {
                            name: "Deal critical hits (x25)",
                            offset: offset,
                            period: 112,
                            tipId: "CriticalHits25",
                            tip: "Currently, the best is to use a shotgun as each pellet counts as a critical hit."
                        };
            }

            function criticalHits50(offset) {
                return {
                            name: "Deal critical hits (x50)",
                            offset: offset,
                            period: 112,
                            tipId: "CriticalHits50",
                            tip: "Currently, the best is to use a shotgun as each pellet counts as a critical hit."
                        };
            }

            function claimLakeside(offset) {
                return {
                            name: "Claim Lakeside Cabins",
                            offset: offset,
                            period: 56,
                        };
            }
            function claimRedRocketMega(offset) {
                return {
                            name: "Claim Red Rocket Mega Stop",
                            offset: offset,
                            period: 56,
                        };
            }

            function completeEventsQuestsGroup(offset) {
                return {
                            name: "Complete Events or Quests in group (x10)",
                            offset: offset,
                            period: 28,
                        };
            }
            function craftScrapWeaponArmor(offset) {
                return {
                            name: "Craft or Scrap weapons or armor",
                            offset: offset,
                            period: 28,
                        };
            }
            function killHugeCreatures(offset) {
                return {
                            name: "Kill huge creatures (any 3)",
                            offset: offset,
                            period: 28,
                            subchallenges: [
                                {
                                    name: "Super Mutant Behemoth",
                                    tipId: "KillHugeSuperMutantBehemoth",
                                    tip: "From the Vantage Point, go down the road towards south-east to find a pond."
                                },
                                {
                                    name: "Deathclaw",
                                    tipId: "KillHugeDeathclaw",
                                    tip: "Check out Deathclaw Island, Hopewell Cave, Thunder Mountain Substation TM-02 north of Watoga."
                                },
                                {
                                    name: "Grafton Monster",
                                    tipId: "KillHugeGraftonMonster",
                                    tip: "In the dried up riverbed between the power plant and the train yard."
                                    + "<br>Near the Charleston Capital fast travel point."
                                },
                                {
                                    name: "Mega Sloth",
                                    tipId: "KillHugeMegasloth",
                                    tip: "Check out South of Mosstown, southeast of the South Belle Motel, NAR Repair Yard,"
                                    + "<br>Cranberry Glade or the Overgrown Sundew Grove."
                                },
                                {
                                    name: "Mirelurk Queen",
                                    tipId: "KillHugeMirelurkQueen",
                                    tip: "Check out Highland Marsh (Mire), Quarry X3 (Cranberry Bog) or Sunrise Field (south of Watoga)."
                                },
                                {
                                    name: "Scorchbeast",
                                    tipId: "KillHugeScorchbeast",
                                    tip: "Any fissure site."
                                },
                                {
                                    name: "Sheepsquatch",
                                    tipId: "KillHugeSheepsquatch",
                                    tip: "Check out the Free Range event or locations such as NAR Repair Yard, Cranberry Glade,"
                                    + "<br>south of the Freakshow in the crater, south of Huntersville towards the crater, "
                                    + "<br>north-west of the Treetop house or west between Berkeley Station and Harper's Ferry."
                                },
                                {
                                    name: "Wendigo Colossus",
                                    tipId: "KillHugeWendigoColossus",
                                    tip: "Nuke fissure prime so that the Overgrown Sundew Grove is in the nuke radius."
                                    + "<br>It has a 7% chance of spawning and keep returning in about 10-15 minutes to trigger a fresh location spawn."
                                },
                            ]
                        };
            }
            function prepareFeast(offset) {
                return {
                            name: "Prepare a feast (all)",
                            offset: offset,
                            period: 28,
                            subchallenges: [
                                {
                                    name: "Chicken meat or Vegetarian Ham (x5)",
                                },
                                {
                                    name: "Instamash or Seasonings (x5)",
                                },
                                {
                                    name: "Cranberries (x10)"
                                },
                                {
                                    name: "Vegetables (x20)"
                                },
                                {
                                    name: "Fruit (x20)",
                                    tipId: "FeastFruit",
                                    tip: "Picking Cranberries count towards this as well."
                                },
                                {
                                    name: "Eggs (x6)",
                                    tipId: "FeastEggs",
                                    tip: "Mothman eggs from Point Pleasant, Mirelurk eggs from Highland Marsh or Radtoad eggs from Grafton."
                                },
                                {
                                    name: "Alcohol, juices or Nuka-Cola (x20)"
                                },
                                {
                                    name: "Sweets, cakes, pies or breads (x10)"
                                },
                            ]
                        };
            }


            function addWeekly(target, offset, func) {
                for (var i = offset; i < offset + 7; i++) {
                    target.push(func(i));
                }
            }

            var challengesWeeklyEra1 = {
                validStart: new Date(Date.UTC(2020, 3, 21, 15, 0, 0, 0)),
                validEnd: new Date(Date.UTC(2020, 5, 23, 15, 0, 0, 0)),
                options: []
            };

            addWeekly(challengesWeeklyEra1.options, 0, completeEvents);
            addWeekly(challengesWeeklyEra1.options, 0, gatherBuildingSupplies);
            addWeekly(challengesWeeklyEra1.options, 0, killInPowerArmor);
            addWeekly(challengesWeeklyEra1.options, 0, killLegendariesMany);
            addWeekly(challengesWeeklyEra1.options, 0, worldOnFire);

            addWeekly(challengesWeeklyEra1.options, 7, completeEventsGroup);
            addWeekly(challengesWeeklyEra1.options, 7, acquireFlux);
            addWeekly(challengesWeeklyEra1.options, 7, buildupCamp);
            addWeekly(challengesWeeklyEra1.options, 7, scorchedTop);
            addWeekly(challengesWeeklyEra1.options, 7, pickManyFlowers);

            addWeekly(challengesWeeklyEra1.options, 35, enemiesGrafton);

            addWeekly(challengesWeeklyEra1.options, 14, craftAlcohol15);
            addWeekly(challengesWeeklyEra1.options, 42, consumeAlcohol10);

            addWeekly(challengesWeeklyEra1.options, 14, criticalHits25);
            addWeekly(challengesWeeklyEra1.options, 42, criticalHits25);

            addWeekly(challengesWeeklyEra1.options, 21, claimLakeside);
            addWeekly(challengesWeeklyEra1.options, 49, claimRedRocketMega);

            addWeekly(challengesWeeklyEra1.options, 21, completeEventsQuestsGroup);
            addWeekly(challengesWeeklyEra1.options, 21, craftScrapWeaponArmor);
            addWeekly(challengesWeeklyEra1.options, 21, killHugeCreatures);
            addWeekly(challengesWeeklyEra1.options, 21, prepareFeast);

            var challengesWeeklyEra2 = {
                validStart: new Date(Date.UTC(2020, 5, 23, 15, 0, 0, 0)),
                validEnd: new Date(Date.UTC(2020, 5, 30, 15, 0, 0, 0)),
                options: []
            };

            addWeekly(challengesWeeklyEra2.options, 0, completeEventsQuestsGroup);
            addWeekly(challengesWeeklyEra2.options, 0, craftAlcohol15);
            addWeekly(challengesWeeklyEra2.options, 0, killHugeCreatures);
            addWeekly(challengesWeeklyEra2.options, 0, acquireFlux);
            addWeekly(challengesWeeklyEra2.options, 0, buildupCamp);


            var challengesWeeklyEra3 = {
                validStart: new Date(Date.UTC(2020, 5, 30, 16, 0, 0, 0)),
                validEnd: undefined,
                options: [
                ]
            };

            function scoreBuildupCamp(offset) {
                return {
                            name: "Build up your C.A.M.P. or Workshop (all)",
                            offset: offset,
                            period: 28,
                            subchallenges: [
                                {
                                    name: "Build containers, displays or shelves (x5)",
                                    tipId: "BuildupCampContainer",
                                    tip: "Simply build another Stash Box."
                                },
                                {
                                    name: "Build wall or floor decorations (x5)",
                                    tipId: "BuildupCampFloor",
                                    tip: "Floor mats are the cheapest to build."
                                },
                                {
                                    name: "Build doors or stairs (x5)",
                                },
                                {
                                    name: "Plant crops or build water sources (x10)",
                                    tipId: "BuildupCampCrops",
                                    tip: "Scrap and replant your vegetables."
                                },
                                {
                                    name: "Build generators or lighting (x20)",
                                    tipId: "BuildupCampLighting",
                                    tip: "Placing the cheapest standing lamp works."
                                },
                            ]
                        };
            }

            function scoreCompleteEventsGroup5(offset) {
                return {
                            name: "Complete Events in group (x5)",
                            offset: offset,
                            period: 28,
                            tipId: "ScoreCompleteEventsGroup",
                            tip: "Public teams work too and no need for proximity."
                        };
            }

            function scoreCraftScrapItems25(offset) {
                return {
                            name: "Craft or scrap weapons, armor or clothing (x25)",
                            offset: offset,
                            period: 28,
                        };
            }

            function scoreDestroyRobots5(offset) {
                return {
                            name: "Destroy various robots (any 5)",
                            offset: offset,
                            period: 28,
                            tipId: "ScoreDestroyRobots",
                            tip: "Watoga has all sorts of robots.",
                            subchallenges: [
                                {
                                    name: "Assaultron"
                                },
                                {
                                    name: "Eyebot (x5)"
                                },
                                {
                                    name: "Liberator  (x5)"
                                },
                                {
                                    name: "Mr. Handy or Mr. Gutsy (x5)"
                                },
                                {
                                    name: "Protectron (x5)"
                                },
                                {
                                    name: "Sentty Bot"
                                },
                                {
                                    name: "Turret (x5)"
                                },
                                {
                                    name: "Vertibot (x5)"
                                },
                            ]
                        };
            }

            function scoreGatherBuildingSupplies25(offset) {
                return {
                            name: "Gather Building Supplies (any 5)",
                            offset: offset,
                            period: 14,
                            tipId: "GatherBuildingSupplies",
                            tip: "You can simply scrap bulk items of these components.",
                            subchallenges: [
                                {
                                    name: "Aluminium (x25)",
                                },
                                {
                                    name: "Concrete (x25)",
                                },
                                {
                                    name: "Copper (x25)",
                                },
                                {
                                    name: "Fertilizer (x25)",
                                },
                                {
                                    name: "Oil (x25)",
                                },
                                {
                                    name: "Screws, spings or gears (x25)",
                                },
                                {
                                    name: "Steel (x100)"
                                },
                                {
                                    name: "Wood (x100)"
                                },
                            ]
                        };
            }

            function scoreKillLegendaries10(offset) {
                return {
                            name: "Kill/destroy legendary enemies (x10)",
                            offset: offset,
                            period: 28,
                        };
            }
            function scoreLevelUp3(offset) {
                return {
                            name: "Level up (x3)",
                            offset: offset,
                            period: 28,
                        };
            }

            function scoreGainXP10000(offset) {
                return {
                            name: "&#x267B; Repeatable: Gain 10.000 XP",
                            offset: offset,
                            period: 28,
                        };
            }

            addWeekly(challengesWeeklyEra3.options, 0, scoreGainXP10000);
            addWeekly(challengesWeeklyEra3.options, 0, scoreBuildupCamp);
            addWeekly(challengesWeeklyEra3.options, 0, scoreCompleteEventsGroup5);
            addWeekly(challengesWeeklyEra3.options, 0, scoreCraftScrapItems25);
            addWeekly(challengesWeeklyEra3.options, 0, scoreDestroyRobots5);
            addWeekly(challengesWeeklyEra3.options, 0, scoreGatherBuildingSupplies25);
            addWeekly(challengesWeeklyEra3.options, 0, scoreKillLegendaries10);
            addWeekly(challengesWeeklyEra3.options, 0, scoreLevelUp3);

            var challengesWeekly = [
                challengesWeeklyEra1,
                challengesWeeklyEra2,
                challengesWeeklyEra3
            ];

            // --------------------------------------------------------------------------------------------------------------

            var infoMap = new Map();
            for (var list of [challenges, challengesWeekly]) {
                for (var challenge of list) {
                    for (var opt of challenge.options) {
                        if (opt.tipId !== undefined) {
                            infoMap.set(opt.tipId, opt.tip);
                        }
                        if (opt.subchallenges !== undefined) {
                            for (var sc of opt.subchallenges) {
                                if (sc.tipId !== undefined) {
                                    infoMap.set(sc.tipId, sc.tip);
                                }
                            }
                        }
                    }
                }
            }

            // add HTML explanation marker
            function info(name) {
                return "&nbsp;<sup><a href='#' style='font-size: 14; font-weight: bold;' onclick='showinfo(this, \"" + name + "\"); return false;'>Tip</a></sup>";
            }

            // popup for explanation
            function showinfo(target, name) {
                var div = document.getElementById("InfoDiv" + name);
                if (div == null) {
                    var div = document.createElement("div");
                    div.style.border = "1px solid black";
                    div.style.padding = "3px";
                    div.style.position = "absolute";
                    div.style.backgroundColor = "#FFFFD0";
                    div.style.zIndex = 99;
                    div.id = "InfoDiv" + name;
                    var txt = infoMap.get(name);

                    if (txt == null) {
                        txt = "??? " + name + " ???";
                    }
                    txt += "<hr><font style='font-size: 14px'>Click to close.</font>";
                    div.innerHTML = txt;

                    target.parentElement.appendChild(div);
                    div.onclick = function() {
                        target.parentElement.removeChild(div);
                    }
                } else {
                    target.parentElement.removeChild(div);
                }
            }

            function updateChallenges() {
                // normalize date
                normalizeDate(selectedDate);

                var endDate = new Date(selectedDate);
                endDate.setDate(endDate.getDate() + 1);

                document.getElementById("showndate").innerHTML = 
                    "<a href='?day=" + selectedDate.toISOString().substring(0, 10) + "' target='_blank'>"
                    + selectedDate.toLocaleDateString() + " " + selectedDate.toLocaleTimeString()
                    + " - " + endDate.toLocaleDateString() + endDate.toLocaleTimeString()
                    + "</a>"
                    ;

                var tbl = document.getElementById("challenges");

                for (var i = tbl.rows.length - 1; i >= 0; i--) {
                    tbl.deleteRow(i);
                }

                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;
                cll.style.textAlign = "center";
                cll.style.fontWeight = "bold";
                cll.style.padding = "10px";
                cll.style.border = '1px dotted black';
                cll.innerHTML = "<span style='font-size: 24px;'>Daily</span><br><span id='remainingtime'></span>";

                renderList(tbl, challenges, endDate);

                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;
                cll.innerHTML = "&nbsp;";

                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;
                cll.style.textAlign = "center";
                cll.style.fontWeight = "bold";
                cll.style.padding = "10px";
                cll.innerHTML = "<span style='font-size: 24px;'>Weekly</span><br><span id='remainingweek'></span>";
                cll.style.border = '1px dotted black';

                renderList(tbl, challengesWeekly, endDate);
            }

            function renderList(tbl, challenges, endDate) {
                var found = false;
                // find a valid challenge among the data
                for (var challenge of challenges) {
                    if (challenge.validStart <= selectedDate
                        && (challenge.validEnd === undefined || challenge.validEnd >= endDate)) {

                        var timeSince = selectedDate.getTime() - challenge.validStart.getTime();
                        var dayDiff = Math.floor(timeSince / 24 / 60 / 60 / 1000);

                        for (var opt of challenge.options) {
                            var d = dayDiff - opt.offset;
                            var per = Math.floor(d % opt.period);
                            if (per === 0) {
                                var rw = tbl.insertRow(tbl.rows.length);
                                
                                var cll = rw.insertCell(rw.cells.length);
                                cll.colSpan = 2;
                                if (opt.tipId !== undefined) {
                                    cll.innerHTML = "<b>" + opt.name + "</b>" + info(opt.tipId);
                                } else {
                                    cll.innerHTML = "<b>" + opt.name + "</b>";
                                }

                                if (opt.subchallenges !== undefined) {
                                    for (var sc of opt.subchallenges) {

                                        rw = tbl.insertRow(tbl.rows.length);
                                        cll = rw.insertCell(rw.cells.length);
                                        cll.innerHTML = "&nbsp;&nbsp;&nbsp;";

                                        cll = rw.insertCell(rw.cells.length);

                                        if (sc.tipId !== undefined) {
                                            cll.innerHTML = sc.name + info(sc.tipId);
                                        } else {
                                            cll.innerHTML = sc.name;
                                        }
                                    }
                                }
                            }
                        }

                        found = true;
                        break;
                    }
                }

                if (!found) {
                    var rw = tbl.insertRow(0);
                    var cll = rw.insertCell();

                    cll.innerText = "No information available for this date";
                    cll.style.textAlign = "center";
                    cll.style.color = "red";
                }

            }

            function updateTimer() {
                // normalize date
                normalizeDate(selectedDate);

                var endDate = new Date(selectedDate);
                endDate.setDate(endDate.getDate() + 1);

                var now = new Date();

                var remainingLabel = document.getElementById("remainingtime");
                if (remainingLabel != null) {
                    if (selectedDate <= now && now < endDate) {
                        var diff = endDate - now;
                        remainingLabel.innerText = formatTime(diff / 1000);
                    } else if (selectedDate < now) {
                        remainingLabel.innerHTML = "Past date. <a href='?'>Return to today.</a>";
                    } else {
                        remainingLabel.innerHTML = "Future date. <a href='?'>Return to today.</a>";
                    }
                }

                var remainingWeekLabel = document.getElementById("remainingweek");
                if (remainingWeekLabel != null) {
                    var startDate = new Date(selectedDate);
                    while (startDate.getDay() != 2) {
                        startDate.setDate(startDate.getDate() - 1);
                    }
                    var endDate = new Date(startDate);
                    endDate.setDate(endDate.getDate() + 7);

                    if (startDate <= now && now < endDate) {
                        var diff = endDate - now;
                        remainingWeekLabel.innerText = formatTime(diff / 1000);
                    } else if (startDate < now) {
                        remainingWeekLabel.innerHTML = "Past date. <a href='?'>Return to today.</a>";
                    } else {
                        remainingWeekLabel.innerHTML = "Future date. <a href='?'>Return to today.</a>";
                    }
                }
            }

            function formatTime(timeSeconds) {
                var days = Math.floor(timeSeconds / 24 / 60 / 60);
                var hours = Math.floor(timeSeconds / 60 / 60) % 24;
                var minutes = Math.floor(timeSeconds / 60) % 60;
                var seconds = Math.floor(timeSeconds % 60);

                var str = "";
                if (days > 0) {
                    str += days + " days ";
                }
                str += padZero(hours) + ":" + padZero(minutes) + ":" + padZero(seconds);
                return str;
            }

            function padZero(n) {
                var str = "";
                if (n < 10) {
                    str += "0";
                }
                str += n;
                return str;
            }

            function goDate(delta) {
                selectedDate.setDate(selectedDate.getDate() + delta);
                updateChallenges();
                updateTimer();
            }

            document.getElementById("prevDay").onclick = evt => goDate(-1);
            document.getElementById("nextDay").onclick = evt => goDate(1);
            document.getElementById("prevWeek").onclick = evt => goDate(-7);
            document.getElementById("nextWeek").onclick = evt => goDate(7);

            setInterval(updateTimer, 1000);
            updateChallenges();
            updateTimer();
        </script>
    </body>
</html>