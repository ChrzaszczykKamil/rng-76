<html>
    <head>
        <title>Fallout 76 Armor Defense Calculator</title>
        <style>
            * {
                font-family: sans-serif;
                font-size: 20px;
            }
            td {
                padding: 1px;
            }
            
            table.infoTable {
               border: 1px solid black;
               border-collapse: collapse;
            }
            table.infoTable td {
               border: 1px solid black;
            }
            .halfopaque {
                opacity: 0.3;
                font-weight: bold; 
                font-size: 26px;
            }
            .results {
                font-weight: bold; 
                font-size: 26px;
            }
            .ptr {
                cursor: pointer;
            }
            .num6 {
                width: 90px;
                text-align: right;
            }
            .bold {
                font-weight: bold;
            }
            .center {
                text-align: center;
            }
            .topline {
                border-top: 1px solid black;
            }
        </style>
        <meta name="keywords" content="Fallout,Fallout 76,Armor,Damage,Resistance,DR,ER,Reduction,Calculation,Comparison,Comparator">
    </head>
    <body style="height: 90%">
        <center>
            <span style="font-size: 36px; font-weight: bold;">Fallout 76 Armor Defense Calculator (0.1.0)</span>
            <br/>
            <!-- <i>(Notification here)</i> -->
        <br/>
        <br/>
        <table id="parent">
            <tr>
                <td style='vertical-align: top;'>
                    <table id="table1" style="border: 1px solid black;">
                        <tr>
                            <td>Armor kind</td>
                            <td>
                                <label class='ptr'><input type="radio" id="NonPA1" name="PA1" value="0"/> Non Power Armor</label>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type="radio" id="PA1" name="PA1" value="1"/> Power Armor</label>
                            </td>
                        </tr>
        
                    </table>            
                </td>
                <td style="padding-left: 20px; padding-right:20px; text-align: center; vertical-align: top; width: 100px;">
                    <button id="copyright" title="Copy Right">&gt;&gt;</button>
                    <br/>
                    <button id="copyleft" title="Copy left">&lt;&lt;</button>
                    <br/>
                    <br/>
                    <br/>
                    <a id='linkleftleft' href="#" title='Link to the left weapon' target='_blank'>&lt; Link</a>
                    <br/>
                    <br/>
                    <a id='linkrightright' href="#" title='Link to the right weapon' target='_blank'>Link &gt;</a>
                    <br/>
                    <br/>
                    <a id='linkboth' href="#" title='Link to both weapons' target='_blank'>&lt; Link &gt;</a>
                    <br/>
                    <br/>
                    <button id="clear" title="Clear" onclick='document.location.search=""; return false;'>Clear</button>
                </td>
                <td style='vertical-align: top;'>
                    <table id="table2" style="border: 1px solid black;">
                        <tr>
                            <td>Armor kind</td>
                            <td>
                                <label class='ptr'><input type="radio" id="NonPA2" name="PA2" value="0"/> Non Power Armor</label>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type="radio" id="PA2" name="PA2" value="1"/> Power Armor</label>
                            </td>
                        </tr>
        
                    </table>            
                </td>
            </tr>
            <tr>
                <td colspan="3" align='center'>
                    <br/>
                    <h2>Enemy</h2>
                    <br/>
                    <table style='border-collapse: collapse; border: 1px solid black;'>
                        <tr>
                            <td>Kind</td>
                            <td><select id='enemykind'>
                                <option value="">Any</option>
                                <option value="Player">Player</option>
                                <option value="Human">Human</option>
                                <option value="SuperMutant">Super Mutant</option>
                                <option value="Animal">Animal</option>
                                <option value="Ghoul">Ghoul</option>
                                <option value="Robot">Robot</option>
                                <option value="Insect">Insect</option>
                                <option value="Mirelurk">Mirelurk</option>
                                <option value="Scorched">Scorched</option>
                            </select></td>
                        </tr>
                        <tr>
                            <td>Damage amount</td>
                            <td>
                                <table style='padding-left: 20px;'>
                                    <tr>
                                        <td>Ballistic</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='100' id='dmgBallistic'></td>
                                        <td>Energy</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgEnergy'></td>
                                        <td>Radiation</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgRadiation'></td>
                                    </tr>
                                    <tr>
                                        <td>Fire</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgFire'></td>
                                        <td>Cryo</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgCryo'></td>
                                        <td>Poison</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgPoison'></td>
                                        </tr>
                                    </table>
                            </td>
                        </tr>
                        <!--
                        <tr>
                            <td>Hit rate</td>
                            <td>
                                <input type="number" class='num6' min='0' maxlength='6' value='1' id='hitsPerSecond'> per second
                            </td>
                        </tr>
                        -->
                        <tr>
                            <td>Armor ignore</td>
                            <td>
                                <input type="number" class='num6' min='0' maxlength='6' value='0' id='armorIgnore'> %
                            </td>
                        </tr>
                        <tr>
                            <td>Damage mode</td>
                            <td>
                                <label class='ptr'><input type='radio' name='dmgType' value='melee' id='dmgTypeMelee'> Melee</label>
                                &nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type='radio' name='dmgType' value='ranged' id='dmgTypeRanged' checked> Ranged</label>
                            </td>
                        </tr>
                        <tr>
                            <td>Energy damage type</td>
                            <td>
                                <label class='ptr'><input type='radio' name='energyType' value='laser' id='energyTypeLaser' checked> Laser</label>
                                &nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type='radio' name='energyType' value='plasma' id='energyTypePlasma'> Plasma</label>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="3" align='center'>
                    <br/>
                    <h2>Comparison</h2>
                    <br/>
                </td>
            </tr>
    </table>
    </center>
    <script>
            var infoMap = new Map();

            // add HTML explanation marker
            function info(name) {
                return "&nbsp;<sup><a href='#' style='font-size: 14; font-weight: bold;' onclick='showinfo(this, \"" + name + "\"); return false;'>?</a></sup>";
            }

            // popup for explanation
            function showinfo(target, name) {
                var div = document.getElementById("InfoDiv" + name);
                if (div == null) {
                    var div = document.createElement("div");
                    div.style.border = "1px solid black";
                    div.style.padding = "3px";
                    div.style.position = "absolute";
                    div.style.backgroundColor = "#FFFFD0";
                    div.style.zIndex = 99;
                    div.id = "InfoDiv" + name;
                    var txt = infoMap.get(name);

                    if (txt == null) {
                        txt = "??? " + name + " ???";
                    }
                    txt += "<hr><font style='font-size: 14px'>Click to close.</font>";
                    div.innerHTML = txt;

                    target.parentElement.appendChild(div);
                    div.onclick = function() {
                        target.parentElement.removeChild(div);
                    }
                } else {
                    target.parentElement.removeChild(div);
                }
            }

            function createBasePA(drs, ers, rrs, ballRed, enerRed, radRed) {
                return (state, idx) => {
                    state.dr += drs[idx];
                    state.er += ers[idx];
                    state.rr += rrs[idx];
                    
                    var rs = getOrCreateReductionSlot(state, "base");
                    rs.ballisticReduction += ballRed;
                    rs.energyReduction += enerRed;
                    rs.radiationReduction += radRed;
                };
            }

            // datasheet
            var armor = {
                "NonPA": {

                },
                "PA": {
                    "Excavator": {
                        name: "Excavator",
                        levels: [25, 35, 45],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([42, 51, 60], [42, 51, 60], [59, 75, 91], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": {
                                        name: "Emergency protocols",
                                        order: 2,
                                        func: (state, index) => {
                                            if (state.player.hp <= 20) {
                                                var rs = getOrCreateReductionSlot(state, "emergency");
                                                rs.ballisticReduction += 50;
                                                rs.energyReduction += 50;
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15),
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15),
                        }
                    }
                }
            };

            var legendaryEffects = {
                "NonPA": {
                    "Prefix": {
                        "Aristocrats": {
                            name: "Aristocrat's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = 20 * clamp(state.player.caps, 0, 29000) / 29000.0;
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Bolstering": {
                            name: "Bolstering",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * (100 - clamp(state.player.hp, 0, 100)) / 100.0);
                                state.dr += c;
                                state.er += c;
                            }
                        },
                        "Overeaters": {
                            name: "Overeater's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(6 * clamp(state.player.fooddrink, 0, 100) / 100.0);
                                var rs = getOrCreateReductionSlot(state, "overeaters");
                                rs.ballisticReduction += c;
                                rs.energyReduction += c;
                            }
                        },
                        "Vanguard": {
                            name: "Vanguard's",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * clamp(state.player.hp, 0, 100) / 100.0);
                                state.dr += c;
                                state.er += c;
                            }
                        },
                        "Mutants": {
                            name: "Mutant's",
                            order: 2,
                            func: (state) => {
                                if (state.player.mutations > 0) {
                                    state.dr += 10;
                                    state.er += 10;
                                }
                            }
                        },
                        "Nocturnal": {
                            name: "Nocturnal",
                            order: 10,
                            func: (state) => {
                                if (state.player.night) {
                                    state.dr *= 1.10;
                                    state.er *= 1.10;
                                }
                            }
                        },
                        "Heavyweight": {
                            name: "Heavyweight",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(20 * clamp(state.player.carrying, 0, 350) / 350.0);
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Assassins": {
                            name: "Assassin's",
                            order: 2,
                            func: createVersusFunc(["Human", "Player"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Ghoulslayers": {
                            name: "Ghoul Slayer's",
                            order: 2,
                            func: createVersusFunc(["Ghoul"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Mutantslayers": {
                            name: "Mutant Slayer's",
                            order: 2,
                            func: createVersusFunc(["SuperMutant"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Hunters": {
                            name: "Hunter's",
                            order: 2,
                            func: createVersusFunc(["Animal"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Exterminators": {
                            name: "Exterminator's",
                            order: 2,
                            func: createVersusFunc(["Insect", "Mirelurk"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Troubleshooters": {
                            name: "Troubleshooter's",
                            order: 2,
                            func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Zealots": {
                            name: "Zealot's",
                            order: 2,
                            func: createVersusFunc(["Scorched"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                    },
                    "Major": {
                        "Radresist": {
                            name: "+25 rad resistance",
                            order: 2,
                            func: (state) => state.rr += 25
                        },
                        "Poisonresist": {
                            name: "+25 poison resistance",
                            order: 2,
                            func: (state) => state.pr += 25
                        },
                        "Fireresist": {
                            name: "+25 fire resistance",
                            order: 2,
                            func: (state) => state.fr += 25
                        },
                        "Cryoresist": {
                            name: "+25 cryo resistance",
                            order: 2,
                            func: (state) => state.cr += 25
                        },
                        "Hardy": {
                            name: "10% explosive damage reduction",
                            order: 2,
                            func: (state) => {
                                var rs = getOrCreateReductionSlot(state, "base");
                                rs.explosiveReduction += 10;
                            }
                        }
                    },
                    "Minor": {
                        "Blocker": {
                            name: "15% less damage when blocking",
                            order: 2,
                            func: (state) => {
                                if (state.player.blocking) {
                                    var rs = getOrCreateReductionSlot(state, "LegendaryBlocker");
                                    rs.ballisticReduction += 15;
                                    rs.energyReduction += 15;
                                }
                            }
                        },
                        "Cavailier": {
                            name: "15% less damage while sprinting",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Sprint") {
                                    var rs = getOrCreateReductionSlot(state, "Sprint");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        },
                        /*
                        "Limbdamage": {
                            name: "15% less limb damage",
                            ballisticReductionPercent: 15,
                            energyReductionPercent: 15,
                            chance: 15
                        },
                        */
                        "Sentinel": {
                            name: "15% less damage while standing still",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Still") {
                                    var rs = getOrCreateReductionSlot(state, "Still");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        }
                    }
                },
                "PA": {
                    "Prefix": {
                        "Aristocrats": {
                            name: "Aristocrat's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * clamp(state.player.caps, 0, 29000) / 29000.0);
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Bolstering": {
                            name: "Bolstering",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * (100 - clamp(state.player.hp, 0, 100)) / 100.0);
                                state.dr += c;
                                state.er += c;
                            }
                        },
                        "Overeaters": {
                            name: "Overeater's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(6 * clamp(state.player.fooddrink, 0, 100) / 100.0);
                                var rs = getOrCreateReductionSlot(state, "overeaters");
                                rs.ballisticReduction += c;
                                rs.energyReduction += c;
                            }
                        },
                        "Vanguard": {
                            name: "Vanguard's",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * clamp(state.player.hp, 0, 100) / 100.0);
                                state.dr += c;
                                state.er += c;
                            }
                        },
                        "Mutants": {
                            name: "Mutant's",
                            order: 2,
                            func: (state) => {
                                if (state.player.mutations > 0) {
                                    state.dr += 10;
                                    state.er += 10;
                                }
                            }
                        },
                        "Nocturnal": {
                            name: "Nocturnal",
                            order: 10,
                            func: (state) => {
                                if (state.player.night) {
                                    state.dr *= 1.10;
                                    state.er *= 1.10;
                                }
                            }
                        },
                        "Heavyweight": {
                            name: "Heavyweight",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * clamp(state.player.carrying, 0, 350) / 350.0);
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Assassins": {
                            name: "Assassin's",
                            order: 2,
                            func: createVersusFunc(["Human", "Player"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Ghoulslayers": {
                            name: "Ghoul Slayer's",
                            order: 2,
                            func: createVersusFunc(["Ghoul"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Mutantslayers": {
                            name: "Mutant Slayer's",
                            order: 2,
                            func: createVersusFunc(["SuperMutant"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Hunters": {
                            name: "Hunter's",
                            order: 2,
                            func: createVersusFunc(["Animal"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Exterminators": {
                            name: "Exterminator's",
                            order: 2,
                            func: createVersusFunc(["Insect", "Mirelurk"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Troubleshooters": {
                            name: "Troubleshooter's",
                            order: 2,
                            func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Zealots": {
                            name: "Zealot's",
                            order: 2,
                            func: createVersusFunc(["Scorched"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                    },
                    "Major": {
                        "Radresist": {
                            name: "+25 rad resistance",
                            order: 2,
                            func: (state) => state.rr += 25
                        },
                        "Poisonresist": {
                            name: "+25 poison resistance",
                            order: 2,
                            func: (state) => state.pr += 25
                        },
                        "Fireresist": {
                            name: "+25 fire resistance",
                            order: 2,
                            func: (state) => state.fr += 25
                        },
                        "Cryoresist": {
                            name: "+25 cryo resistance",
                            order: 2,
                            func: (state) => state.cr += 25
                        },
                        "Hardy": {
                            name: "10% explosive damage reduction",
                            order: 2,
                            func: (state) => {
                                var rs = getOrCreateReductionSlot(state, "base");
                                rs.explosiveReduction += 10;
                            }
                        }
                    },
                    "Minor": {
                        "Blocker": {
                            name: "15% less damage when blocking",
                            order: 2,
                            func: (state) => {
                                if (state.player.blocking) {
                                    var rs = getOrCreateReductionSlot(state, "LegendaryBlocker");
                                    rs.ballisticReduction += 15;
                                    rs.energyReduction += 15;
                                }
                            }
                        },
                        "Cavailier": {
                            name: "15% less damage while sprinting",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Sprint") {
                                    var rs = getOrCreateReductionSlot(state, "Sprint");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        },
                        /*
                        "Limbdamage": {
                            name: "15% less limb damage",
                            ballisticReductionPercent: 15,
                            energyReductionPercent: 15,
                            chance: 15
                        },
                        */
                        "Sentinel": {
                            name: "15% less damage while standing still",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Still") {
                                    var rs = getOrCreateReductionSlot(state, "Still");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        }
                    }
                }
            };

            function createSimpleFoodFunc(meat, resistName, resistAmount) {
                return (state) => {
                    if (meat) {
                        if (state.player.carnivore) {
                            if (state.player.teammates > 0 && state.player.strangeInNumbers) {
                                state[resistName] += 5 * resistAmount / 2;
                            } else {
                                state[resistName] += 2 * resistAmount;
                            }
                        }
                        else if (!state.player.herbivore) {
                            state[resistName] += resistAmount;
                        }
                    } else {
                        if (state.player.herbivore) {
                            if (state.player.teammates > 0 && state.player.strangeInNumbers) {
                                state[resistName] += 5 * resistAmount / 2;
                            } else {
                                state[resistName] += 2 * resistAmount;
                            }
                        }
                        else if (!state.player.carnivore) {
                            state[resistName] += resistAmount;
                        }
                    }
                };
            }

            var consumables = {
                "Food": {
                    "Bakedbloatlfy": {
                        name: "Baked Bloatfly (+10 RR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "rr", 10)
                    },
                    "Bloatflyloaf": {
                        name: "Bloatfly Loaf (+30 RR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "rr", 30)
                    },
                    "Cranberryjam": {
                        name: "Cranberry Jam (+10 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "dr", 10)
                    },
                    "Crispycavecricket": {
                        name: "Crispy Cave Cricket (+10 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 10)
                    },
                    "Firecaptastysouffle": {
                        name: "Firecap Tasty Souffle (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "er", 35)
                    },
                    "Friedfogcrawler": {
                        name: "Fried Fog Crawler (+20 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "dr", 20)
                    },
                    "Headhuntercheese": {
                        name: "Headhunter's Headcheese (+10 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "dr", 10)
                    },
                    "Megaslothtenderloin": {
                        name: "Megasloth Tenderloin (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 35)
                    },
                    "Mirelurkcakealoi": {
                        name: "Mirelurk Cake with Bloodleaf Aloi (+30 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 30)
                    },
                    "Mirelurkjerky": {
                        name: "Mirelurk Jerky (+15 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 15)
                    },
                    "Potholepotpie": {
                        name: "Pothole Potpie (+10 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "dr", 10)
                    },
                    "Radscorpionfilet": {
                        name: "Radscorpion Filet (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 35)
                    },
                    "Radscorpionsteak": {
                        name: "Radscorpion Steak (+25 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 25)
                    },
                    "Roastmegasloth": {
                        name: "Roast Megaslot (+25 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 25)
                    },
                    "Scorchbeast Steak": {
                        name: "Scorchbeast Steak (+15 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "dr", 15)
                    },
                    "Strawberryperkgum": {
                        name: "Strawberry Perk Bubblegum (+1 DR)",
                        order: 2,
                        func: (state) => state.dr =+ 1,
                    },
                    "Cavefungussoup": {
                        name: "Cave Fungus Soup (+10 PR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "pr", 10)
                    },
                    "Firecapsoup": {
                        name: "Firecap Soup (+25 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "er", 25)
                    },
                    "Glowingfungussoup": {
                        name: "Glowing Fungus Soup (+20 RR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "rr", 20)
                    },
                    "Glowingfunguspuree": {
                        name: "Glowing Fungus Puree (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "er", 35)
                    },
                    "Radstagstew": {
                        name: "Radstag Stew (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 35)
                    },
                    "Siltbeanpuree": {
                        name: "Silt Bean Puree (+15 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "dr", 15)
                    },
                    "Tatosoup": {
                        name: "Tato Soup (+10 PR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "pr", 10)
                    },
                },
                "Drink": {
                    "Leadchampagne": {
                        name: "Lead Champagne (+15 DR, +100 RR)",
                        debuff: ["dr", "rr"],
                        order: 2,
                        func: (state) => {
                            var party = 1
                            if (state.player.partyPerson) {
                                party *= state.player.partyPerson;
                            }
                            state.dr += 15 * party;
                            state.rr += 100 * party;
                        }
                    },
                    "Leadchampagnebellini": {
                        name: "Lead Champagne Bellini (+15 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => {
                            var party = 1
                            if (state.player.partyPerson) {
                                party *= state.player.partyPerson;
                            }
                            state.dr += 15 * party;
                        }
                    },
                    "Leadchampagnemimosa": {
                        name: "Lead Champagne Mimosa (+100 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => {
                            var party = 1
                            if (state.player.partyPerson) {
                                party *= state.player.partyPerson;
                            }
                            state.rr += 100 * party;
                        }
                    },
                    "Nukacolablood": {
                        name: "Nuka Cola My Blood (-15% DMG from Scorched)",
                        debuff: ["nukascorched"],
                        order: 2,
                        func: createNukaScorched()
                    },
                    "Nukacolascorched": {
                        name: "Nuka Cola Scorched (-15% DMG from Scorched)",
                        debuff: ["nukascorched"],
                        order: 2,
                        func: createNukaScorched()
                    },
                    "Nukacolavaccinated": {
                        name: "Nuka Cola Vaccinated (-15% DMG from Scorched)",
                        debuff: ["nukascorched"],
                        order: 2,
                        func: createNukaScorched()
                    },
                    "Nukacolaorange": {
                        name: "Nuka Cola Orange (+25 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => {
                            var nuka = 1;
                            if (state.player.colanut) {
                                nuka *= state.player.colanut;
                            }
                            state.rr += 25 * nuka;
                        }
                    },
                    "Steepedstranglerbloomtea": {
                        name: "Steeped Strangler Bloom Tea (+20 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 20,
                    },
                    /*
                    "Whiterussian": {
                        name: "White Russian (-20% limb DMG)",
                        ballisticReductionPercent: 20,
                        energyReductionPercent: 20,
                        chance: 15
                    },
                    */
                },
                "Chem": {
                    "Fury": {
                        name: "Fury (+25 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                    "Glowingbloodpack": {
                        name: "Glowing Blood Pack (+75 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 75,
                    },
                    "Insectrepellent": {
                        name: "Insectre Rellent (-15% DMG from Insects)",
                        debuff: ["insectrepellent"],
                        order: 2,
                        func: (state) => {
                            if (state.enemy.kind === "Insect") {
                                var rs = getOrCreateReductionSlot(state, "Insect");
                                rs.ballisticReduction += 15;
                                rs.energyReduction += 15;
                            }
                        },
                    },
                    "Irradiatedbloodpack": {
                        name: "Irradiated Blood Pack (+75 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 75,
                    },
                    "Medx": {
                        name: "Med-X (+25 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                    "Psycho": {
                        name: "Psycho (+25 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                    "Psychotats": {
                        name: "Psychotats (+15 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 15,
                    },
                    "Radx": {
                        name: "Rad-X (+100 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 100,
                    },
                    "Radxdiluted": {
                        name: "Rad-X Diluted (+50 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 50,
                    },
                    "Radshield": {
                        name: "Radshield (+300 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 300,
                    },
                    "Superchem1": {
                        name: "Super Chem Mk1 (+25 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                },
                "Magazine": {
                    "Astoundingly8": {
                        name: "Astoundingly... #8 (-20% DMG from Robots)",
                        order: 2,
                        func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [20, 20])
                    },
                    "Astoundingly9": {
                        name: "Astoundingly... #9 (+15 PR)",
                        order: 2,
                        func: state => state.pr += 15,
                    },
                    "Grognak3": {
                        name: "Grognak... #3 (+15 PR)",
                        order: 2,
                        func: state => state.pr += 15,
                    },
                    "Grognak8": {
                        name: "Grognak... #8 (+2 DR)",
                        order: 2,
                        func: state => state.dr += 2,
                    },
                    "Grognak10": {
                        name: "Grognak... #10 (+15 ER)",
                        order: 2,
                        func: state => state.er += 15,
                    },
                    "Guns6": {
                        name: "Guns... #6 (+10 DR at night)",
                        order: 2,
                        func: state => {
                            if (state.player.night) {
                                state.dr += 10;
                            }
                        }
                    },
                    "Live6": {
                        name: "Live... #6 (+10 DR in team)",
                        order: 2,
                        func: state => {
                            if (state.player.teammates > 0) {
                                state.dr += 10;
                            }
                        }
                    },
                    "Live9": {
                        name: "Live... #9 (-25% DMG from Robots)",
                        order: 2,
                        func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Scouts2": {
                        name: "Scout's... #2 (-25% DMG from Insects)",
                        order: 2,
                        func: createVersusFunc(["Insect"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Scouts7": {
                        name: "Scout's... #7 (-25% DMG from Animals)",
                        order: 2,
                        func: createVersusFunc(["Animal"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Tesla1": {
                        name: "Tesla... #1 (-25% DMG from Robots)",
                        order: 2,
                        func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Tesla2": {
                        name: "Tesla... #2 (-20% DMG from plasma)",
                        order: 2,
                        func: (state) => {
                            if (state.enemy.energyType === "plasma") {
                                var rs = getOrCreateReductionSlot(state, "Plasma");
                                rs.ballisticReduction += 20;
                                rs.energyReduction += 20;
                            }
                        },
                    },
                    "Tesla6": {
                        name: "Tesla... #6 (+15 RR)",
                        order: 2,
                        func: (state) => state.rr += 15
                    },
                    "US1": {
                        name: "U.S... #1 (+10 DR while sneaking)",
                        order: 2,
                        func: (state) => {
                            if (state.player.sneaking) {
                                state.dr += 10;
                            }
                        }
                    },
                    "US3": {
                        name: "U.S... #3 (-10% DMG from Players)",
                        order: 2,
                        func: createVersusFunc(["Player"], ["ballisticReduction", "energyReduction"], [10, 10])
                    },
                    "Unstoppables1": {
                        name: "Unstop... #1 (5% chance for 0 DMG)",
                        order: 2,
                        func: (state) => {
                            var rs = getOrCreateReductionSlot(state, "unstoppables");
                            rs.ballisticReduction += 5;
                            rs.energyReduction += 5;
                        }
                    },
                    "Unstoppables2": {
                        name: "Unstop... #2 (20% chance for 0 DMG from Scorched)",
                        order: 2,
                        func: (state) => {
                            if (state.enemy.kind === "Scorched") {
                                var rs = getOrCreateReductionSlot(state, "unstoppables");
                                rs.ballisticReduction += 20;
                                rs.energyReduction += 20;
                            }
                        }
                    },
                    "Unstoppables3": {
                        name: "Unstop... #3 (30% chance for 0 DMG from explosions)",
                        order: 2,
                        func: (state) => {
                            var rs = getOrCreateReductionSlot(state, "unstoppables");
                            rs.explosiveReduction += 30
                        }
                    },
                    "Unstoppables4": {
                        name: "Unstop... #4 (30% chance for 0 melee DMG)",
                        order: 2,
                        func: (state) => {
                            if (state.enemy.damageType === "melee") {
                                var rs = getOrCreateReductionSlot(state, "unstoppables");
                                rs.ballisticReduction += 30;
                                rs.energyReduction += 30;
                            }
                        }
                    },
                    "Unstoppables5": {
                        name: "Unstop... #5 (30% chance for 0 energy DMG)",
                        order: 2,
                        func: (state) => {
                            var rs = getOrCreateReductionSlot(state, "unstoppables");
                            rs.energyReduction += 30
                        }
                    },
                },
            };

            function createNukaScorched() {
                return (state) => {
                            if (state.enemy.kind === "Scorched") {
                                var nuka = 1;
                                if (state.player.colanut) {
                                    nuka *= state.player.colanut;
                                }
                                var rs = getOrCreateReductionSlot(state, "scorched");
                                rs.ballisticReduction += 15 * nuka;
                                rs.energyReduction += 15 * nuka;
                            }
                        };
            }

            function createVersusFunc(versusList, reductionKeyList, valueList) {
                return state => {
                    if (versusList.includes(state.enemy.kind)) {
                        var rs = getOrCreateReductionSlot(state, state.enemy.kind);
                        for (var i = 0; i < reductionKeyList.length; i++) {
                            rs[reductionKeyList[i]] += valueList[i];
                        }
                    }
                }
            }

            var backpackLevels = [1, 10, 20, 30, 40, 50];
            var backpackMods = {
                "Armorplated": {
                    name: "Armor Plated",
                    order: 2,
                    func: (state, level) => {
                        var arg = [15, 30, 45, 60, 75, 90];
                        state.dr += arg[level];
                    }
                },
                "Highcapacity": {
                    name: "High capacity",
                    order: 2,
                    func: (state, level) => {
                        var arg = [-10, -20, -30, -40, -50, -60];
                        state.er += arg[level];
                        state.rr += arg[level];
                    }
                },
                "Insulated": {
                    name: "Insulated",
                    order: 2,
                    func: (state, level) => {
                        var arg = [15, 30, 45, 60, 75, 90];
                        state.er += arg[level];
                    }
                },
                "Leadlined": {
                    name: "Lead Lined",
                    order: 2,
                    func: (state, level) => {
                        var arg = [15, 30, 45, 60, 75, 90];
                        state.rr += arg[level];
                    }
                },
            };

            function get(id) {
                return document.getElementById(id);
            }
            function getValue(id) {
                return get(id).value;
            }
            function getBool(id) {
                return get(id).checked;
            }

            function getOpt(id) {
                var sel = get(id);
                return sel.options[sel.selectedIndex];
            }


            function createBodyPart(tbl, index, mode, part) {

                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.className = "bold topline";
                var titleCll = cll;

                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline";

                let makeSel = document.createElement("select");
                cll.appendChild(makeSel);
                makeSel.id = index + "_Part_" + part;
                makeSel.oninput = evt => recalculate(index);

                var opt = document.createElement("option");
                opt.text = "None";
                makeSel.options.add(opt);

                var span = document.createElement("span");
                span.innerHTML = "&nbsp;&nbsp;&nbsp;";
                cll.appendChild(span);
                var fullSet = document.createElement("a");
                fullSet.innerText = "<set all>";
                fullSet.href = "#";
                fullSet.onclick = evt => makeFullSet(part, index);
                cll.appendChild(fullSet);

                var armors = armor[mode];

                for (let a in armors) {
                    let am = armors[a];
                    let p = am[part];
                    let pfunc = p.func;
                    titleCll.innerText = p.name;
                    for (let lvl in am.levels) {
                        opt = document.createElement("option");
                        opt.value = a + "-" + am.levels[lvl];
                        opt.text = armors[a].name + " - " + am.levels[lvl];
                        opt.level = lvl;
                        opt.data = {
                            order: p.order,
                            func: (state) => pfunc(state, lvl) 
                        }
                        opt.mods = p.mods;
                        opt.make = a;
                        opt.category = am.category;
                        makeSel.options.add(opt);
                    }
                }

                rw = tbl.insertRow(tbl.rows.length);
                rw.id = index + "_Part_" + part + "_ModStart";

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "Mods";
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "<select armor make above>";

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "Legendary";
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "<select armor make above>";

                rw = tbl.insertRow(tbl.rows.length);
                rw.id = index + "_Part_" + part + "_ModEnd";

                makeSel.oninput = evt => {
                    createMods(tbl, index, mode, part, makeSel);
                    recalculate(index);
                };
            }

            function makeFullSet(part, index) {
                var sel = getOpt(index + "_Part_" + part);

                for (var p of ["Helmet", "Torso", "LA", "RA", "LL", "RL"]) {
                    if (p != part) {
                        var s2 = get(index + "_Part_" + p);
                            if (s2 != null) {

                            for (var i = 0; i < s2.options.length; i++) {
                                var o = s2.options[i];
                                if (o.value === sel.value && o.level == sel.level) {
                                    s2.selectedIndex = i;
                                    s2.dispatchEvent(new Event("input"));
                                    break;
                                }
                            }
                        }
                    }
                }
                return false;
            }

            function createMods(tbl, index, mode, part, sel) {
                var sidx = findRow(tbl, index + "_Part_" + part + "_ModStart") + 1;
                var eidx = findRow(tbl, index + "_Part_" + part + "_ModEnd");
                removeRows(tbl, sidx, eidx);

                let opt = sel.options[sel.selectedIndex];
                let mods = opt.mods;
                let lvl = opt.level;

                if (sel.selectedIndex > 0) {                    
                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);

                    cll.innerText = "Mods";

                    if (mods === undefined) {
                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "No relevant mod";
                    } else {
                        for (var slot in mods) {
                            rw = tbl.insertRow(sidx++);
                            cll = rw.insertCell(rw.cells.length);

                            cll.innerHTML = "&nbsp;&nbsp;&nbsp;" + slot;
    
                            cll = rw.insertCell(rw.cells.length);
                            let modSel = document.createElement("select");
                            cll.appendChild(modSel);
                            modSel.id = index + "_Part_" + part + "_Mod_" + slot;
                            modSel.oninput = evt => recalculate(index);

                            opt = document.createElement("option");
                            opt.text = "None";
                            modSel.options.add(opt);

                            var modList = [];

                            for (var m in mods[slot]) {
                                var mod = mods[slot][m];
                                modList.push({ key:m, value: mod});
                            }

                            modList.sort((a, b) => a.value.name.localeCompare(b.value.name));

                            for (let mod of modList) {
                                opt = document.createElement("option");
                                opt.value = mod.key;
                                opt.text = mod.value.name;
                                opt.data = { 
                                    order: mod.value.order, 
                                    func: (state) => mod.value.func(state, lvl) };
                                modSel.options.add(opt);
                            }
                        }
                    }

                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);

                    cll.innerText = "Legendary";

                    for (var le in legendaryEffects[mode]) {
                        var eff = legendaryEffects[mode][le];
                        rw = tbl.insertRow(sidx++);
                        cll = rw.insertCell(rw.cells.length);

                        cll.innerHTML = "&nbsp;&nbsp;&nbsp;" + le;

                        let legSel = document.createElement("select");
                        cll = rw.insertCell(rw.cells.length);
                        cll.appendChild(legSel);
                        legSel.oninput = evt => recalculate(index);
                        
                        legSel.id = index + "_Part_" + part + "_Legendary_" + le;
                        opt = document.createElement("option");
                        legSel.options.add(opt);

                        var effList = [];
                        for (var e in eff) {
                            effList.push({ key: e, value: eff[e] })
                        }
                        effList.sort((a, b) => a.value.name.localeCompare(b.value.name));

                        for (var e of effList) {
                            opt = document.createElement("option");
                            opt.value = e.key;
                            opt.text = e.value.name;
                            opt.data = { order: e.value.order, func: e.value.func };
                            legSel.options.add(opt);
                        }
                    }
                } else {
                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "Mods";
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "<select armor make above>";

                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "Legendary";
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "<select armor make above>";
                }
            }

            function findRow(tbl, id) {
                for (var i = 0; i < tbl.rows.length; i++) {
                    if (tbl.rows[i].id == id) {
                        return i;
                    }
                }
                return -1;
            }

            function removeRows(tbl, start, end) {
                if (end === undefined) {
                    end = tbl.rows.length;
                }
                for (var i = end - 1; i >= start; i--) {
                    tbl.deleteRow(i);
                }
            }

            function createNumber(tbl, name, key, min, max, value, unit) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;" + name;

                cll = rw.insertCell(rw.cells.length);

                var input = document.createElement("input");
                cll.appendChild(input);
                input.type = "number";
                input.min = min;
                input.max = max;
                input.value = value;
                input.className = "num6";
                input.id = key;

                if (unit) {
                    cll.appendChild(document.createTextNode(unit));
                }
                return input;
            }

            function createParams(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Player";
                cll.className = "topline";
                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline";

                createNumber(tbl, "Health", index + "_HP", 0, 100, 100, " %").oninput = evt => recalculate(index);
                createNumber(tbl, "Caps", index + "_Caps", 0, 30000, 0).oninput = evt => recalculate(index);
                createNumber(tbl, "Food &amp; Drink", index + "_Fooddrink", 0, 100, 100, " %").oninput = evt => recalculate(index);
                createNumber(tbl, "Carrying", index + "_Carry", 0, 30000, 0, " lb").oninput = evt => recalculate(index);
                createNumber(tbl, "Teammates", index + "_Teammates", 0, 3, 0).oninput = evt => recalculate(index);
                createNumber(tbl, "&nbsp;&nbsp;&nbsp;Deaths", index + "_Teamdeaths", 0, 3, 0).oninput = evt => recalculate(index);

                if (mode === "NonPA") {
                    createNumber(tbl, "Strength", index + "_Strength", 1, 100, 1).oninput = evt => recalculate(index);
                    createNumber(tbl, "Agility", index + "_Agility", 1, 100, 1).oninput = evt => recalculate(index);
                    createNumber(tbl, "Junk Amount", index + "_Junkamount", 0, 46, 0).oninput = evt => recalculate(index);
                }

                createYesNo(tbl, index, "Night", "&nbsp;&nbsp;&nbsp;Night time");
                createYesNo(tbl, index, "Block", "&nbsp;&nbsp;&nbsp;Blocking");
                createYesNo(tbl, index, "Fireheavy", "&nbsp;&nbsp;&nbsp;Firing a heavy gun");
                createYesNo(tbl, index, "Sneak", "&nbsp;&nbsp;&nbsp;Sneaking");

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Stance";

                cll = rw.insertCell(rw.cells.length);

                var stanceSel = document.createElement("select");
                cll.appendChild(stanceSel);
                stanceSel.id = index + "_Stance";

                var opt = document.createElement("option");
                opt.value = "Run";
                opt.text = "Running";
                stanceSel.options.add(opt);

                opt = document.createElement("option");
                opt.value = "Sprint";
                opt.text = "Sprinting";
                stanceSel.options.add(opt);

                opt = document.createElement("option");
                opt.value = "Still";
                opt.text = "Standing Still";
                stanceSel.options.add(opt);

                stanceSel.oninput = evt => recalculate(index);
            }

            function createBlockerFunc(amount) {
                return orderFunc(2, (state) => {
                    if (state.enemy.damageType === "melee") {
                        var rs = getOrCreateReductionSlot(state, "Blocker");
                        rs.ballisticReduction += amount;
                        rs.energyReduction += amount;
                    }
                });
            }

            function clamp(v, min, max) {
                if (v < min) {
                    return min;
                }
                if (v > max) {
                    return max;
                }
                return v;
            }

            function createJunkShieldFunc(amount) {
                return orderFunc(2, state => {
                    var ja = clamp(state.player.junkamount, 0, 46);
                    var res = Math.floor((ja + 4) / 5);
                    state.dr += res * amount;
                    state.er += res * amount;
                });
            }

            function createBodyGuardFunc(amount) {
                return orderFunc(2, state => {
                    var res = amount * clamp(state.player.teammates, 0, 3);
                    state.dr += res;
                    state.er += res;
                });
            }

            function createPerks(tbl, index, mode) {
                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Perks";

                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Blocker", index + "_Blocker", ["None", "1", "2", "3"], ["", "15", "30", "45"], [
                    null,
                    createBlockerFunc(15),
                    createBlockerFunc(30),
                    createBlockerFunc(45)
                ], false, " (rank)").oninput = evt => recalculate(index);

                if (mode == "NonPA") {
                    createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Junk Shield", index + "_Junkshield", ["None", "1", "2", "3"], ["", "10", "20", "30"], [
                        null,
                        createJunkShieldFunc(1),
                        createJunkShieldFunc(2),
                        createJunkShieldFunc(3),
                    ], false, " (rank)").oninput = evt => recalculate(index);
                    createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Barbarian", index + "_Barbarian", ["None", "1", "2", "3"], ["", "2", "3", "4"]).oninput = evt => recalculate(index);
                    createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Evasive", index + "_Evasive", ["None", "1", "2", "3"], ["", "1", "2", "3"]).oninput = evt => recalculate(index);
                    createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Ironclad", index + "_Ironclad", ["None", "1", "2", "3", "4", "5"], ["", "10", "20", "30", "40", "50"]).oninput = evt => recalculate(index);
                    createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Moving Target", index + "_Movingtarget", ["None", "1", "2", "3"], ["", "15", "30", "45"]).oninput = evt => recalculate(index);
                    createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Serendipity", index + "_Serendipity", ["None", "1", "2", "3"], ["", "15", "30", "45"]).oninput = evt => recalculate(index);
                    //createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Adamantium Skeleton", index + "_Adamantium", ["None", "1", "2", "3"], ["", "30", "60", "100"]).oninput = evt => recalculate(index);
                }
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Bodyguards", index + "_Bodyguards", ["None", "1", "2", "3", "4"], ["", "6", "8", "10", "12"], [
                    null,
                    createBodyGuardFunc(6),
                    createBodyGuardFunc(8),
                    createBodyGuardFunc(10),
                    createBodyGuardFunc(12),
                ], false, " (rank)").oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Bullet Shield", index + "_Bulletshield", ["None", "1", "2", "3"], ["", "20", "40", "60"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Refractor", index + "_Refractor", ["None", "1", "2", "3", "4"], ["", "10", "20", "30", "40"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Dodgy", index + "_Dodgy", ["None", "1", "2", "3"], ["", "10", "20", "30"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Nerd Rage", index + "_Nerdrage", ["None", "1", "2", "3"], ["", "20", "30", "40"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Suppressor", index + "_Suppressor", ["None", "1", "2", "3"], ["", "10", "20", "30"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Lone Wanderer", index + "_Lonewanderer", ["None", "1", "2", "3"], ["", "10", "15", "20"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Rad Resistant", index + "_Radresistant", ["None", "1", "2", "3", "4"], ["", "10", "20", "30", "40"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Fireproof", index + "_Fireproof", ["None", "1", "2", "3"], ["", "15", "30", "45"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Cola Nut", index + "_Colanut", ["None", "1", "2"], ["", "2", "3"], [
                    null,
                    orderFunc(0, state => state.player.colanut = 2),
                    orderFunc(0, state => state.player.colanut = 3),
                ]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Party Person", index + "_Partyperson", ["None", "1", "2"], ["", "2", "3"], [
                    null,
                    orderFunc(0, state => state.player.partyPerson = 2),
                    orderFunc(0, state => state.player.partyPerson = 3),
                ]).oninput = evt => recalculate(index);
                createYesNo(tbl, index, "&nbsp;&nbsp;&nbsp;Strangeinnumbers", "&nbsp;&nbsp;&nbsp;Strange In Numbers", undefined, 
                    orderFunc(0, state => state.player.strangeInNumbers = true)
                );
                //createSelectWithData(tbl, "Class Freak", index + "_Classfreak", ["None", "1", "2", "3"], ["", "25", "50", "75"]).oninput = evt => recalculate(index);

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Legendary Perks";

                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Funky Duds", index + "_Funkyduds", ["None", "1", "2", "3", "4"], ["", "50", "100", "150", "200"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Sizzling Style", index + "_Sizzlingstyle", ["None", "1", "2", "3", "4"], ["", "50", "100", "150", "200"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Blood Sacrifice", index + "_Bloodsacrifice", ["None", "1", "2", "3", "4"], ["", "25", "30", "35", "40"]).oninput = evt => recalculate(index);
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;What Rads", index + "_Whatrads", ["None", "1", "2", "3", "4"], ["", "50", "75", "100", "300"]).oninput = evt => recalculate(index);

            }

            function createOptions(sel, texts, values, data) {
                for (var i = 0; i < texts.length; i++) {
                    var opt = document.createElement("option");
                    opt.text = texts[i];
                    opt.value = values[i];
                    if (data) {
                        opt.data = data[i];
                    }
                    sel.options.add(opt);
                }
            }

            function createSelectWithData(tbl, name, key, texts, values, data, fullLine, unit) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = name;

                if (fullLine) {
                    rw = tbl.insertRow(tbl.rows.length);
                }
                cll = rw.insertCell(rw.cells.length);
                if (fullLine) {
                    cll.colSpan = 2;
                    var span = document.createElement("span");
                    span.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                    cll.appendChild(span);
                }
                var sel = document.createElement("select");
                sel.id = key;
                cll.appendChild(sel);

                createOptions(sel, texts, values, data);

                if (unit) {
                    cll.appendChild(document.createTextNode(unit));
                }

                return sel;
            }

            function createMutations(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Mutations";

                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Food-related", index + "_Foodbuff", 
                    ["None", "Carnivore", "Herbivore"], 
                    ["", "Carnivore", "Herbivore"],
                    [
                        null,
                        orderFunc(1, state => {
                            state.player.carnivore = true;
                            state.player.mutations++;
                        }),
                        orderFunc(1, state => { 
                            state.player.herbivore = true; 
                            state.player.mutations++;
                        }),
                    ]
                ).oninput = evt => recalculate(index);

                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Empath", index + "_Empath",
                        ["None", "Self", "Teammate", "Both"],
                        ["", "Self", "Teammate", "Both"],
                        [
                            null,
                            orderFunc(1, state => {
                                state.player.mutations++;
                            }),
                            orderFunc(1, state => {
                                state.player.mutations++;
                            }),
                            orderFunc(1, state => {
                                state.player.mutations++;
                            }),
                        ]
                ).oninput = evt => recalculate(index);

                createYesNo(tbl, index, "Grounded", "&nbsp;&nbsp;&nbsp;Grounded", undefined, 
                    orderFunc(1, state => {
                        state.player.mutations++;
                    })
                );
                createYesNo(tbl, index, "Scalyskin", "&nbsp;&nbsp;&nbsp;Scaly Skin", undefined, 
                    orderFunc(1, state => {
                        state.player.mutations++;
                    })
                );
            }

            function createConsumableList(cll, index, mode, consumableName) {
                var foodDiv = document.createElement("div");
                foodDiv.style.height = 120;
                foodDiv.style.paddingLeft = 40;
                foodDiv.style.overflowY = "scroll";
                cll.appendChild(foodDiv);
                let foodList = [];
                for (var food in consumables[consumableName]) {
                    var f = consumables[consumableName][food];

                    foodList.push({key: food, value: f });
                }
                foodList.sort((a, b) => a.value.name.localeCompare(b.value.name));
                var fcnt = 0;
                for (let f of foodList) {
                    if (fcnt++ > 0) {
                        foodDiv.appendChild(document.createElement("br"));
                    }
                    var lbl = document.createElement("label");
                    foodDiv.appendChild(lbl);

                    var cb = document.createElement("input");
                    cb.type = "checkbox";
                    cb.id = index + "_" + consumableName + "_" + f.key;
                    cb.value = "Food_" + f.key;
                    cb.data = {
                        order: f.value.order,
                        func: f.value.func,
                    };
                    f.cb = cb;
                    f.debuff = f.value.debuff;
                    cb.oninput = evt => {
                        debuff(foodList, f);
                        recalculate(index);
                    };
                    lbl.appendChild(cb);

                    lbl.appendChild(document.createTextNode(" " + f.value.name));
                }
            }

            function debuff(list, current) {
                if (current.value.debuff) {
                    for (var key of current.value.debuff) {
                        for (var f of list) {
                            if (f != current) {
                                if (f.debuff && f.debuff.includes(key)) {
                                    f.cb.checked = false;
                                }
                            }
                        }
                    }
                }
            }

            function createConsumables(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Consumables";

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);

                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Food";
                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;

                createConsumableList(cll, index, mode, "Food");


                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Drink";

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;

                createConsumableList(cll, index, mode, "Drink");

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Chem";

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;

                createConsumableList(cll, index, mode, "Chem");

                var texts = ["None"];
                var values = [""];
                var data = [null];
                var magList = [];
                for (var mag in consumables["Magazine"]) {
                    var m = consumables["Magazine"][mag];
                    magList.push({ key: mag, value: m })
                }
                magList.sort((a, b) => a.value.name.localeCompare(b.value.name));

                for (var kv of magList) {
                    texts.push(kv.value.name);
                    values.push(kv.key);
                    data.push({ order: kv.value.order, func: kv.value.func });

                }
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Magazine", index + "_Magazine", texts, values, data, true).oninput = evt => recalculate(index);
            }

            function createResults(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);

                cll.className = "topline results";
                cll.innerText = "Resistances";

                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline results";
                cll.id = "Resistances" + index;

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);

                cll.className = "results";
                cll.innerText = "Reductions";

                cll = rw.insertCell(rw.cells.length);
                cll.className = "results";
                cll.id = "Reductions" + index;
            }

            function createYesNo(tbl, index, key, name, tip, data) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = name;
                if (tip !== undefined) {
                    cll.innerHTML += info(key);
                }

                cll = rw.insertCell(rw.cells.length);
                
                var yes = createRadio(index + "_" + key, index + "_" + key + "_yes", "Yes");
                yes.radio.data = data;
                yes.radio.oninput = evt => recalculate(index);
                cll.appendChild(yes.label);

                var sep = document.createElement("span");
                cll.appendChild(sep);
                sep.innerHTML = "&nbsp;&nbsp;&nbsp;";

                var no = createRadio(index + "_" + key, index + "_" + key + "_no", "No");
                no.radio.oninput = evt => recalculate(index);
                no.radio.checked = "checked";
                cll.appendChild(no.label);
            }

            function createRadio(key, id, name) {
                var lblYes = document.createElement("label");
                lblYes.className = "ptr";

                var yes = document.createElement("input");
                lblYes.appendChild(yes);
                yes.id = id;
                yes.type = "radio";
                yes.name = key;

                lblYes.appendChild(document.createTextNode(name));

                return { label: lblYes, radio : yes };
            }

            function createBackpack(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.className = "topline bold";
                cll.innerText = "Other";
                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline";

                var modList = [];
                for (var bm in backpackMods) {
                    modList.push({key: bm, value: backpackMods[bm] })
                }
                modList.sort((a, b) => a.value.name.localeCompare(b.value.name));
                var texts = [ "None" ];
                var values = [ "" ];
                var data = [ null ];
                for (let bm of modList) {
                    for (let blIdx = 0; blIdx < backpackLevels.length; blIdx++) {
                        let bl = backpackLevels[blIdx];
                        texts.push(bm.value.name + " - " + bl);
                        values.push(bm.key + "_" + bl);
                        data.push(
                        { 
                            order: bm.value.order, 
                            func: (state) => bm.value.func(state, blIdx)
                        });
                    }
                }
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Backpack", index + "_Backpack", texts, values, data).oninput = evt => recalculate(index);
            }

            function createSide(index, mode) {                
                var tbl = get("table" + index);
                removeRows(tbl, 1);
                if (mode === "PA") {
                    createBodyPart(tbl, index, mode, "Helmet");
                }
                createBodyPart(tbl, index, mode, "Torso");
                createBodyPart(tbl, index, mode, "LA");
                createBodyPart(tbl, index, mode, "RA");
                createBodyPart(tbl, index, mode, "LL");
                createBodyPart(tbl, index, mode, "RL");
                if (mode === "NonPA") {
                    createBackpack(tbl, index, mode);
                }
                createParams(tbl, index, mode);
                createPerks(tbl, index, mode);
                createMutations(tbl, index, mode);
                createConsumables(tbl, index, mode);

                createResults(tbl, index, mode);

                recalculate(index);
            }

            function orderFunc(order, func) {
                return {
                    order: order,
                    func: func
                };
            }

            function getOrCreateReductionSlot(state, name) {
                var rs = state.reductionSlots[name];
                if (!rs) {
                    rs = {
                        ballisticReduction: 0,
                        energyReduction: 0,
                        radiationReduction: 0,
                        fireReduction: 0,
                        cryoReduction: 0,
                        poisonReduction: 0,
                        explosiveReduction: 0,
                    }
                    state.reductionSlots[name] = rs;
                }

                return rs;
            }

            function recalculate(index) {

                if (get(index + "_HP") == null) {
                    return;
                }

                let state = {
                    player: {},
                    enemy: {}
                };

                state.player.hp = parseInt(getValue(index + "_HP"));
                state.player.caps = parseInt(getValue(index + "_Caps"));
                state.player.carrying = parseInt(getValue(index + "_Carry"));
                state.player.fooddrink = parseInt(getValue(index + "_Fooddrink"));
                state.player.teammates = parseInt(getValue(index + "_Teammates"));
                state.player.teamdeaths = parseInt(getValue(index + "_Teamdeaths"));
                state.player.night = getBool(index + "_Night_yes");
                state.player.blocking = getBool(index + "_Block_yes");
                state.player.sneaking = getBool(index + "_Sneak_yes");
                state.player.fireheavy = getBool(index + "_Fireheavy_yes");
                state.player.stance = getValue(index + "_Stance");
                state.player.mode = getBool("NonPA" + index) ? "NonPA" : "PA";
                state.player.mutations = 0;

                state.dr = 0;
                state.er = 0;
                state.rr = 0;
                state.fr = 0;
                state.cr = 0;
                state.pr = 0;
                state.xr = 0;

                state.reductionSlots = {};

                if (state.player.mode === "NonPA") {
                    state.player.strength = getValue(index + "_Strength");
                    state.player.agility = getValue(index + "_Agility");
                    state.player.junkamount = getValue(index + "_Junkamount");
                }

                state.enemy.kind = getOpt("enemykind").value;
                state.enemy.ballisticDamage = getValue("dmgBallistic");
                state.enemy.energyDamage = getValue("dmgEnergy");
                state.enemy.radiationDamage = getValue("dmgRadiation");
                state.enemy.fireDamage = getValue("dmgFire");
                state.enemy.cryoDamage = getValue("dmgCryo");
                state.enemy.poisonDamage = getValue("dmgPoison");
                state.enemy.armorIgnore = getValue("armorIgnore");
                state.enemy.damageType = getBool("dmgTypeMelee") ? "melee" : "ranged";
                state.enemy.energyType = getBool("energyTypePlasma") ? "plasma" : "laser";

                var modifiers = [];

                var armorMakes = [];
                var armorPieces = 0;
                var armorCategories = [];

                outer:
                for (var tagName of ["input", "select"]) {
                    for (var elem of document.getElementsByTagName(tagName)) {
                        if (elem.id.startsWith(index + "_")) {
                            if (elem.id.startsWith(index + "_Part_")) {
                                if (elem.selectedIndex && elem.selectedIndex > 0 && elem.make && elem.category) {
                                    if (!armorMakes.includes(elem.make)) {
                                        armorMakes.push(elem.make);
                                    }
                                    if (!armorCategories.includes(elem.category)) {
                                        armorCategories.push(elem.category);
                                    }
                                    armorPieces++;
                                }
                            }
                            if (elem.selectedIndex && elem.selectedIndex > 0) {
                                var opt = elem.options[elem.selectedIndex];
                                if (opt.data.order === undefined) {
                                    //alert(elem.id + " no order specified in its data attribute")
                                    continue;
                                }
                                if (!opt.data.func) {
                                    //alert(elem.id + " no function specified in its data attribute")
                                    continue;
                                }
                                modifiers.push(opt.data);
                            } else {
                                if (!elem.data) {
                                    continue;
                                }
                                if (elem.data.order === undefined) {
                                    //alert(elem.id + " no order specified in its data attribute")
                                    continue;
                                }
                                if (!elem.data.func) {
                                    //alert(elem.id + " no function specified in its data attribute")
                                    continue;
                                }
                                if (elem.type === "radio" && elem.id.endsWith("_yes") && elem.checked) {
                                    modifiers.push(elem.data);
                                }
                                else if (elem.type === "checkbox" && elem.checked) {
                                    modifiers.push(elem.data);
                                }
                            }
                        }
                    }
                }

                state.player.fullSet = false;
                state.player.fullSetCategory = false;

                if (state.player.mode === "PA") {
                    state.player.fullSet = armorPieces === 6 && armorMakes.length === 1;
                    state.player.fullSetCategory = true;
                } else {
                    state.player.fullSet = armorPieces === 5 && armorMakes.length === 1;
                    state.player.fullSetCategory = armorPieces === 5 && armorMakes.length === 1 && armorCategories.length === 1;
                }

                modifiers.sort((a, b) => a.order < b.order ? -1 : (a.order > b.order ? 1 : 0));

                for (var mod of modifiers) {
                    mod.func(state);
                }

                state.ballisticReduction = 1;
                state.energyReduction = 1;
                state.radiationReduction = 1;
                state.fireReduction = 1;
                state.cryoReduction = 1;
                state.poisonReduction = 1;
                state.explosiveReduction = 1;

                for (var rsKey in state.reductionSlots) {
                    var rs = state.reductionSlots[rsKey];
                    state.ballisticReduction *= (1 - rs.ballisticReduction / 100.0);
                    state.energyReduction *= (1 - rs.energyReduction / 100.0);
                    state.radiationReduction *= (1 - rs.radiationReduction / 100.0);
                    state.fireReduction *= (1 - rs.fireReduction / 100.0);
                    state.cryoReduction *= (1 - rs.cryoReduction / 100.0);
                    state.poisonReduction *= (1 - rs.poisonReduction / 100.0);
                    state.explosiveReduction *= (1 - rs.explosiveReduction / 100.0);
                }

                state.ballisticReduction = 1 - state.ballisticReduction;
                state.energyReduction = 1 - state.energyReduction;
                state.radiationReduction = 1 - state.radiationReduction;
                state.fireReduction = 1 - state.fireReduction;
                state.cryoReduction = 1 - state.cryoReduction;
                state.poisonReduction = 1 - state.poisonReduction;
                state.explosiveReduction = 1 - state.explosiveReduction;

                // results

                var resiliences = get("Resistances" + index);

                resiliences.innerHTML = createDamageDisplayHTML(
                    state.dr, state.er, 
                    state.rr, state.fr, 
                    state.cr, state.pr, 
                    state.xr, "", 0);

                var reductions = get("Reductions" + index);

                reductions.innerHTML = createDamageDisplayHTML(
                    state.ballisticReduction * 100.0, state.energyReduction * 100.0, 
                    state.radiationReduction * 100.0, state.fireReduction * 100.0,
                    state.cryoReduction * 100.0, state.poisonReduction * 100.0, 
                    state.explosiveReduction * 100.0, " %", 2);
            }

            function createDamageDisplayHTML(ballistic, energy, radiation, fire, cold, poison, explosive, unit, decimals) {
                var result = "";
                if (ballistic < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;\u2316&nbsp;" + ballistic.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;\u2316&nbsp;" + ballistic.toFixed(decimals) + unit;
                }
                if (energy < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;\u21AF&nbsp;" + energy.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;\u21AF&nbsp;" + energy.toFixed(decimals) + unit;
                }
                if (radiation < 0.01) {
                    result += "<br><span class='halfopaque'>&nbsp;&nbsp;&nbsp;\u2622&nbsp;" + radiation.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "<br>&nbsp;&nbsp;&nbsp;\u2622&nbsp;" + radiation.toFixed(decimals) + unit;
                }

                if (fire < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x1F525;&nbsp;" + fire.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;&#x1F525;&nbsp;" + fire.toFixed(decimals);
                }
                if (cold < 0.01) {
                    result += "<br><span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x2744;&nbsp;" + cold.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "<br>&nbsp;&nbsp;&nbsp;&#x2744;&nbsp;" + cold.toFixed(decimals);
                }
                if (poison < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x1F4A7;&nbsp;" + poison.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;&#x1F4A7;&nbsp;" + poison.toFixed(decimals);
                }
                if (explosive < 0.01) {
                    result += "<br><span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x1F4A5;&nbsp;" + explosive.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "<br>&nbsp;&nbsp;&nbsp;&#x1F4A5;&nbsp;" + explosive.toFixed(decimals) + unit;
                }
                return result;
            }

            function recalculateBoth() {
                recalculate(1);
                recalculate(2);
            }

            get("NonPA1").oninput = evt => createSide(1, "NonPA");
            get("PA1").oninput = evt => createSide(1, "PA");
            get("NonPA2").oninput = evt => createSide(2, "NonPA");
            get("PA2").oninput = evt => createSide(2, "PA");

            get("enemykind").oninput = evt => recalculateBoth();
            get("dmgBallistic").oninput = evt => recalculateBoth();
            get("dmgEnergy").oninput = evt => recalculateBoth();
            get("dmgRadiation").oninput = evt => recalculateBoth();
            get("dmgFire").oninput = evt => recalculateBoth();
            get("dmgCryo").oninput = evt => recalculateBoth();
            get("dmgPoison").oninput = evt => recalculateBoth();
            get("armorIgnore").oninput = evt => recalculateBoth();
            get("dmgTypeMelee").oninput = evt => recalculateBoth();
            get("dmgTypeRanged").oninput = evt => recalculateBoth();
            get("energyTypePlasma").oninput = evt => recalculateBoth();
            get("energyTypeLaser").oninput = evt => recalculateBoth();

    </script>
</body>
</html>